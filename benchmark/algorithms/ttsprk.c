#include <stdio.h>
#include <stdlib.h>
#include <string.h>

/*
Notes about adapting EEMBC algorithms to run on a standalone
baremetal Flute processor, without having the th_lib.h and 
without following the official/proper EEMBC benchmark harness:

- replace every occurence of tcdef
- copy data input (algotst.c) 
- remove CRC check
- replace functions that start with "th_" except those declared in "includes/eembc_adaptation.h"
- remove first parameter from each call of th_exit (this is some kind of ID that is defined in the unavailable th_lib.h)
- remove all lines that mention RAMfile...
- remove GetTestData function, it is reduntant (possibly by design, it would allow to load data from a file into ram, but in this case the data is already in ram)
- rename data variable names to match "inpAngleROM" array name
- remove "struct TCDef *tcdef parameter" from "t_run_test" function
- copy algo.h to algorithms directory, rename it to "<main file name>.h" and put guard headers "ifndef" inside it. Remove functions declarations from it.
- the "<main file name>.h" should include <eembc_adaptation.h> at the top
- the code has 2 output functions: "WriteOut" and "DebugOut"

- replace each call to GetInputValues with:

    isTableLooped = loop_cnt >= sizeof(inpAngleROM)/sizeof(inpAngleROM[0]);
    angleCounter = inpAngleROM[input_index]; //    angleCounter = inpAngleROM[loop_cnt % (sizeof(inpAngleROM)/sizeof(inpAngleROM[0]))];

*/

// originally file.h was "algo.h"
#include "ttsprk.h" // change to the name of the main file (eg. "a2time.h")

// forward declarations
static int t_run_test( int argc, const char *argv[] );
static n_int GetInputValues( n_void );
static n_int GetYTables( n_void );
static n_int GetZTables( n_void );

// function to be called from a separate main file
int ttsprk(int argc, const char *argv[]) {
    return t_run_test(argc, argv);
}

// input data (inpROM)

static varsize *engSpeedValue ;  /* Test data input variable table for 'engSpeed' */
static varsize *angleTimeValue ; /* Test data input variable table for 'angleTime' */
static varsize *airIntakeValue ; /* Test data input variable table for 'airIntake' */
static varsize *airTempValue ;   /* Test data input variable table for 'airTemp' */
static varsize *engTempValue ;   /* Test data input variable table for 'engTemp' */
static varsize *batteryValue ;   /* Test data input variable table for 'battery' */
static varsize *throttleValue ;  /* Test data input variable table for 'throttle' */
static n_int *knockedValue ;       /* Test data input variable table for 'knocked' */
static n_int *crankingValue ;      /* Test data input variable table for 'cranking' */

/*  TEST DATA TABLE : 
*
*    engSpeed, angleTime, airIntake, airTemp, engTemp, battery,
*    throttle, knocked, cranking
*
*/    

static const varsize inpValueROM[] = {
    /* Source of the test data, in ROM */
    /* 10 */ 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0, 0, 0, 0, 20, 20, 125, 0, 0, 0,    
    /* 20 */ 10, 3600, 0, 20, 20, 110, 100, 0, 1, 20, 3240, 0, 20, 20, 110, 100, 0, 1, 30, 2880, 0, 20, 20, 110, 100, 0, 1, 40, 2520, 0, 20, 20, 110, 100, 0, 1, 50, 2160, 0, 20, 20, 110, 100, 0, 1, 60, 1800, 0, 20, 20, 110, 100, 0, 1, 70, 1440, 0, 20, 20, 110, 100, 0, 1, 80, 1080, 0, 20, 20, 110, 100, 0, 1, 90, 720, 0, 20, 20, 110, 100, 0, 1, 100, 360, 0, 20, 20, 110, 100, 0, 1,    
    /* 30 */ 200, 3600, 0, 20, 20, 110, 100, 0, 1, 200, 3240, 0, 20, 20, 110, 100, 0, 1, 200, 2880, 0, 20, 20, 110, 100, 0, 1, 200, 2520, 0, 20, 20, 110, 100, 0, 1, 200, 2160, 0, 20, 20, 110, 100, 0, 1, 200, 1800, 0, 20, 20, 110, 100, 0, 1, 200, 1440, 0, 20, 20, 110, 100, 0, 1, 200, 1080, 0, 20, 20, 110, 100, 0, 1, 200, 720, 0, 20, 20, 110, 100, 0, 1, 200, 360, 0, 20, 20, 110, 100, 0, 1,    
    /* 40 */ 200, 3600, 0, 20, 20, 110, 100, 0, 1, 200, 3240, 0, 20, 20, 110, 100, 0, 1, 200, 2880, 0, 20, 20, 110, 100, 0, 1, 200, 2520, 0, 20, 20, 110, 100, 0, 1, 200, 2160, 0, 20, 20, 110, 100, 0, 1, 200, 1800, 0, 20, 20, 110, 100, 0, 1, 200, 1440, 0, 20, 20, 110, 100, 0, 1, 200, 1080, 0, 20, 20, 110, 100, 0, 1, 200, 720, 0, 20, 20, 110, 100, 0, 1, 200, 360, 0, 20, 20, 110, 100, 0, 1,    
    /* 50 */ 200, 3600, 0, 20, 20, 110, 100, 0, 1, 200, 3240, 0, 20, 20, 110, 100, 0, 1, 200, 2880, 0, 20, 20, 110, 100, 0, 1, 200, 2520, 0, 20, 20, 110, 100, 0, 1, 200, 2160, 0, 20, 20, 110, 100, 0, 1, 200, 1800, 0, 20, 20, 110, 100, 0, 1, 200, 1440, 0, 20, 20, 110, 100, 0, 1, 200, 1080, 0, 20, 20, 110, 100, 0, 1, 200, 720, 0, 20, 20, 110, 100, 0, 1, 200, 360, 0, 20, 20, 110, 100, 0, 1,    
    /* 60 */ 300, 3600, 100, 20, 20, 120, 100, 0, 0, 300, 3240, 100, 20, 20, 120, 100, 0, 0, 300, 2880, 100, 20, 20, 120, 100, 0, 0, 300, 2520, 100, 20, 20, 120, 100, 0, 0, 300, 2160, 100, 20, 20, 120, 100, 0, 0, 300, 1800, 100, 20, 20, 120, 100, 0, 0, 300, 1440, 100, 20, 20, 120, 100, 0, 0, 300, 1080, 100, 20, 20, 120, 100, 0, 0, 300, 720, 100, 20, 20, 120, 100, 0, 0, 300, 360, 100, 20, 20, 120, 100, 0, 0,    
    /* 70 */ 300, 3600, 100, 20, 21, 120, 100, 0, 0, 300, 3240, 100, 20, 22, 120, 100, 0, 0, 300, 2880, 100, 20, 23, 120, 100, 0, 0, 300, 2520, 100, 20, 24, 120, 100, 0, 0, 300, 2160, 100, 20, 25, 120, 100, 0, 0, 300, 1800, 100, 20, 26, 120, 100, 0, 0, 300, 1440, 100, 20, 27, 120, 100, 0, 0, 300, 1080, 100, 20, 28, 120, 100, 0, 0, 300, 720, 100, 20, 29, 120, 100, 0, 0, 300, 360, 100, 20, 30, 120, 100, 0, 0,    
    /* 80 */ 300, 3600, 100, 20, 31, 120, 100, 0, 0, 300, 3240, 100, 20, 32, 120, 100, 0, 0, 300, 2880, 100, 20, 33, 120, 100, 0, 0, 300, 2520, 100, 20, 34, 120, 100, 0, 0, 300, 2160, 100, 20, 35, 120, 100, 0, 0, 300, 1800, 100, 20, 36, 120, 100, 0, 0, 300, 1440, 100, 20, 37, 120, 100, 0, 0, 300, 1080, 100, 20, 38, 120, 100, 0, 0, 300, 720, 100, 20, 39, 120, 100, 0, 0, 300, 360, 100, 20, 40, 120, 100, 0, 0,    
    /* 90 */ 300, 3600, 100, 20, 41, 120, 100, 0, 0, 300, 3240, 100, 20, 42, 120, 100, 0, 0, 300, 2880, 100, 20, 43, 120, 100, 0, 0, 300, 2520, 100, 20, 44, 120, 100, 0, 0, 300, 2160, 100, 20, 45, 120, 100, 0, 0, 300, 1800, 100, 20, 46, 120, 100, 0, 0, 300, 1440, 100, 20, 47, 120, 100, 0, 0, 300, 1080, 100, 20, 48, 120, 100, 0, 0, 300, 720, 100, 20, 49, 120, 100, 0, 0, 300, 360, 100, 20, 50, 120, 100, 0, 0,    
    /* 100 */ 400, 3600, 100, 20, 50, 120, 100, 0, 0, 400, 3240, 100, 20, 50, 120, 100, 0, 0, 400, 2880, 100, 20, 50, 120, 100, 0, 0, 400, 2520, 100, 20, 50, 120, 100, 0, 0, 400, 2160, 100, 20, 50, 120, 100, 0, 0, 400, 1800, 100, 20, 50, 120, 100, 0, 0, 400, 1440, 100, 20, 50, 120, 100, 0, 0, 400, 1080, 100, 20, 50, 120, 100, 0, 0, 400, 720, 100, 20, 50, 120, 100, 0, 0, 400, 360, 100, 20, 50, 120, 100, 0, 0,    
    /* 110 */ 400, 3600, 100, 20, 50, 120, 110, 0, 0, 400, 3240, 100, 20, 50, 120, 120, 0, 0, 400, 2880, 100, 20, 50, 120, 130, 0, 0, 400, 2520, 100, 20, 50, 120, 140, 0, 0, 400, 2160, 100, 20, 50, 120, 150, 0, 0, 400, 1800, 100, 20, 50, 120, 160, 0, 0, 400, 1440, 100, 20, 50, 120, 170, 0, 0, 400, 1080, 100, 20, 50, 120, 180, 0, 0, 400, 720, 100, 20, 50, 120, 190, 0, 0, 400, 360, 100, 20, 50, 120, 200, 0, 0,    
    /* 120 */ 400, 3600, 200, 20, 50, 120, 200, 0, 0, 400, 3240, 200, 20, 50, 120, 200, 0, 0, 400, 2880, 200, 20, 50, 120, 200, 0, 0, 400, 2520, 200, 20, 50, 120, 200, 0, 0, 400, 2160, 200, 20, 50, 120, 200, 0, 0, 400, 1800, 200, 20, 50, 120, 200, 0, 0, 400, 1440, 200, 20, 50, 120, 200, 0, 0, 400, 1080, 200, 20, 50, 120, 200, 0, 0, 400, 720, 200, 20, 50, 120, 200, 0, 0, 400, 360, 200, 20, 50, 120, 200, 0, 0,    
    /* 130 */ 390, 3600, 300, 20, 50, 120, 200, 0, 0, 390, 3240, 300, 20, 50, 120, 200, 0, 0, 380, 2880, 300, 20, 50, 120, 200, 0, 0, 380, 2520, 300, 20, 50, 120, 200, 0, 0, 380, 2160, 300, 20, 50, 120, 200, 0, 0, 370, 1800, 300, 20, 50, 120, 200, 0, 0, 370, 1440, 300, 20, 50, 120, 200, 0, 0, 370, 1080, 300, 20, 50, 120, 200, 0, 0, 370, 720, 300, 20, 50, 120, 200, 0, 0, 360, 360, 300, 20, 50, 120, 200, 0, 0,    
    /* 140 */ 370, 3600, 300, 20, 50, 120, 200, 0, 0, 370, 3240, 300, 20, 50, 120, 200, 0, 0, 370, 2880, 300, 20, 50, 120, 200, 0, 0, 370, 2520, 300, 20, 50, 120, 200, 0, 0, 380, 2160, 300, 20, 50, 120, 200, 0, 0, 390, 1800, 300, 20, 50, 120, 200, 0, 0, 390, 1440, 300, 20, 50, 120, 200, 0, 0, 400, 1080, 300, 20, 50, 120, 200, 0, 0, 400, 720, 300, 20, 50, 120, 200, 0, 0, 410, 360, 300, 20, 50, 120, 200, 0, 0,    
    /* 150 */ 410, 3600, 310, 20, 50, 120, 200, 0, 0, 410, 3240, 310, 20, 50, 120, 200, 0, 0, 400, 2880, 320, 20, 50, 120, 200, 0, 0, 400, 2520, 320, 20, 50, 120, 200, 0, 0, 400, 2160, 330, 20, 50, 120, 200, 0, 0, 390, 1800, 330, 20, 50, 120, 200, 0, 0, 390, 1440, 340, 20, 50, 120, 200, 0, 0, 390, 1080, 340, 20, 50, 120, 200, 0, 0, 380, 720, 350, 20, 50, 120, 200, 0, 0, 380, 360, 350, 20, 50, 120, 200, 0, 0,    
    /* 160 */ 410, 3600, 310, 20, 51, 120, 200, 0, 0, 410, 3240, 310, 20, 52, 120, 200, 0, 0, 400, 2880, 320, 20, 53, 120, 200, 0, 0, 400, 2520, 320, 20, 54, 120, 200, 0, 0, 400, 2160, 330, 20, 55, 120, 200, 0, 0, 390, 1800, 330, 20, 56, 120, 200, 0, 0, 390, 1440, 340, 20, 57, 120, 200, 0, 0, 390, 1080, 340, 20, 58, 120, 200, 0, 0, 380, 720, 350, 20, 59, 120, 200, 0, 0, 380, 360, 350, 20, 60, 120, 200, 0, 0,    
    /* 170 */ 370, 3600, 310, 20, 61, 120, 200, 0, 0, 370, 3240, 310, 20, 62, 120, 200, 0, 0, 360, 2880, 320, 20, 63, 120, 200, 0, 0, 360, 2520, 320, 20, 64, 120, 200, 0, 0, 360, 2160, 330, 20, 65, 120, 200, 0, 0, 350, 1800, 330, 20, 66, 120, 200, 0, 0, 350, 1440, 340, 20, 67, 120, 200, 0, 0, 350, 1080, 340, 20, 68, 120, 200, 0, 0, 350, 720, 350, 20, 69, 120, 200, 0, 0, 350, 360, 350, 20, 70, 120, 200, 0, 0,    
    /* 180 */ 350, 3600, 350, 20, 61, 120, 200, 0, 0, 360, 3240, 350, 20, 62, 121, 200, 0, 0, 370, 2880, 350, 20, 63, 122, 200, 0, 0, 380, 2520, 350, 20, 64, 123, 200, 0, 0, 390, 2160, 350, 20, 65, 124, 200, 0, 0, 400, 1800, 350, 20, 66, 125, 210, 0, 0, 410, 1440, 350, 20, 67, 126, 220, 0, 0, 420, 1080, 350, 20, 68, 127, 230, 0, 0, 430, 720, 350, 20, 69, 128, 240, 0, 0, 440, 360, 350, 20, 70, 129, 250, 0, 0,    
    /* 190 */ 440, 3600, 350, 20, 61, 120, 260, 0, 0, 440, 3240, 350, 20, 62, 121, 270, 0, 0, 440, 2880, 350, 20, 63, 122, 280, 0, 0, 450, 2520, 350, 20, 64, 123, 290, 0, 0, 450, 2160, 350, 20, 65, 124, 300, 0, 0, 450, 1800, 350, 20, 66, 125, 300, 0, 0, 450, 1440, 350, 20, 67, 126, 300, 0, 0, 460, 1080, 350, 20, 68, 127, 300, 0, 0, 460, 720, 350, 20, 69, 128, 300, 0, 0, 460, 360, 350, 20, 70, 129, 300, 0, 0,    
    /* 200 */ 440, 3600, 350, 20, 61, 129, 260, 0, 0, 440, 3240, 350, 20, 62, 128, 270, 0, 0, 440, 2880, 350, 20, 63, 127, 280, 0, 0, 450, 2520, 350, 20, 64, 126, 290, 0, 0, 450, 2160, 350, 20, 65, 125, 300, 0, 0, 450, 1800, 350, 20, 66, 124, 300, 0, 0, 450, 1440, 350, 20, 67, 123, 300, 0, 0, 460, 1080, 350, 20, 68, 122, 300, 0, 0, 460, 720, 350, 20, 69, 121, 300, 0, 0, 460, 360, 350, 20, 70, 120, 300, 0, 0,    
} ; /* End of test data table 'inpValueROM' */

/*  THE TABLES */    

static const varsize airIntakeROM[] = {        
    0, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500
} ;    /* End of table 'airIntakeROM' - x axis, many tables */


static const varsize engSpeedROM[] = {        
    0, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500, 2600, 2700, 2800, 2900, 3000, 3100, 3200, 3300, 3400, 3500, 3600, 3700, 3800, 3900, 4000, 4100, 4200, 4300, 4400, 4500, 4600, 4700, 4800, 4900, 5000
} ; /* End of table 'engSpeedROM' - y axis, many tables */

static const varsize lambdaROM[] = {        
    100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 170, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 380, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 450, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 530, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 600, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 670, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 740, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 900, 810, 810, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 900, 800, 720, 640, 560, 520, 480, 460, 440, 420, 420, 420, 420, 420, 730, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 900, 880, 880, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 900, 780, 750, 670, 590, 540, 490, 470, 450, 430, 430, 430, 430, 430, 860, 1030, 1070, 1110, 1150, 1160, 1170, 1160, 1150, 1140, 1140, 1150, 1170, 1190, 1190, 1090, 990, 880, 950, 950, 1030, 1070, 1110, 1150, 1160, 1170, 1160, 1150, 1140, 1140, 1150, 1170, 1190, 1190, 1090, 990, 880, 780, 750, 670, 590, 540, 490, 470, 450, 430, 430, 430, 430, 430, 860, 1020, 1060, 1100, 1140, 1150, 1160, 1150, 1140, 1130, 1130, 1140, 1160, 1180, 1180, 1080, 980, 880, 1020, 1020, 1020, 1060, 1100, 1140, 1150, 1160, 1150, 1140, 1130, 1130, 1140, 1160, 1180, 1180, 1080, 980, 880, 780, 750, 700, 590, 540, 490, 470, 450, 430, 430, 430, 430, 430, 860, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 860, 1090, 1090, 1040, 1080, 1120, 1160, 1170, 1180, 1170, 1160, 1150, 1150, 1160, 1180, 1200, 1200, 1100, 1000, 860, 860, 780, 750, 670, 590, 540, 490, 470, 440, 440, 440, 440, 440, 860, 1120, 1160, 1200, 1240, 1250, 1260, 1250, 1240, 1230, 1230, 1240, 1240, 1220, 1200, 1180, 1080, 880, 1110, 1080, 1120, 1160, 1200, 1240, 1250, 1260, 1250, 1240, 1230, 1230, 1240, 1240, 1220, 1200, 1180, 1080, 880, 880, 780, 750, 670, 590, 540, 490, 470, 440, 440, 440, 440, 440, 860, 1200, 1240, 1280, 1320, 1330, 1340, 1330, 1320, 1310, 1310, 1320, 1300, 1270, 1240, 1210, 1160, 920, 1130, 1160, 1200, 1240, 1280, 1320, 1330, 1340, 1330, 1320, 1310, 1310, 1320, 1300, 1270, 1240, 1210, 1160, 920, 920, 760, 680, 600, 560, 520, 500, 480, 460, 460, 460, 460, 460, 860, 1220, 1260, 1300, 1340, 1350, 1360, 1350, 1340, 1330, 1330, 1330, 1310, 1280, 1070, 1060, 1040, 920, 1150, 1180, 1220, 1260, 1300, 1340, 1350, 1360, 1350, 1340, 1330, 1330, 1330, 1310, 1280, 1070, 1060, 1040, 920, 920, 760, 680, 600, 560, 520, 500, 480, 460, 460, 460, 460, 460, 860, 1240, 1280, 1320, 1360, 1370, 1380, 1370, 1360, 1350, 1340, 1340, 1320, 1290, 1070, 1060, 1040, 920, 1160, 1200, 1240, 1280, 1320, 1360, 1370, 1380, 1370, 1360, 1350, 1340, 1340, 1320, 1290, 1070, 1060, 1040, 920, 920, 760, 680, 600, 560, 520, 500, 480, 460, 460, 460, 460, 460, 860, 1260, 1300, 1340, 1380, 1390, 1400, 1390, 1380, 1370, 1350, 1350, 1330, 1300, 1080, 1070, 1040, 940, 1180, 1220, 1260, 1300, 1340, 1380, 1390, 1400, 1390, 1380, 1370, 1350, 1350, 1330, 1300, 1080, 1070, 1040, 940, 940, 770, 720, 660, 600, 720, 750, 700, 660, 660, 660, 660, 660, 870, 1280, 1320, 1360, 1400, 1410, 1420, 1410, 1400, 1390, 1360, 1360, 1340, 1310, 1080, 1070, 1050, 940, 1200, 1240, 1280, 1320, 1360, 1400, 1410, 1420, 1410, 1400, 1390, 1360, 1360, 1340, 1310, 1080, 1070, 1050, 940, 940, 770, 760, 720, 700, 920, 1000, 1050, 860, 860, 860, 860, 860, 880, 1300, 1340, 1380, 1420, 1430, 1440, 1430, 1420, 1410, 1370, 1370, 1350, 1320, 1090, 1080, 1070, 1060, 1210, 1260, 1300, 1340, 1380, 1420, 1430, 1440, 1430, 1420, 1410, 1370, 1370, 1350, 1320, 1090, 1080, 1070, 1060, 1050, 1050, 1040, 1080, 1120, 1160, 1200, 1200, 1060, 1060, 1060, 1060, 1060, 1080, 1310, 1350, 1390, 1430, 1440, 1450, 1440, 1440, 1420, 1380, 1380, 1360, 1330, 1310, 1270, 1250, 1220, 1230, 1270, 1310, 1350, 1390, 1430, 1440, 1450, 1440, 1440, 1420, 1380, 1380, 1360, 1330, 1310, 1270, 1250, 1220, 1200, 1250, 1300, 1350, 1400, 1450, 1400, 1080, 1160, 1160, 1160, 1160, 1160, 1280, 1320, 1360, 1400, 1430, 1450, 1460, 1450, 1450, 1430, 1390, 1390, 1370, 1340, 1300, 1260, 1240, 1260, 1250, 1280, 1320, 1360, 1400, 1430, 1450, 1460, 1450, 1450, 1430, 1390, 1390, 1370, 1340, 1300, 1260, 1240, 1260, 1300, 1350, 1400, 1450, 1500, 1550, 1500, 1400, 1200, 1200, 1200, 1200, 1200, 1380, 1330, 1370, 1410, 1430, 1460, 1470, 1460, 1460, 1440, 1400, 1400, 1380, 1350, 1290, 1250, 1230, 1220, 1270, 1290, 1330, 1370, 1410, 1430, 1460, 1470, 1460, 1460, 1440, 1400, 1400, 1380, 1350, 1290, 1250, 1230, 1220, 1240, 1290, 1340, 1390, 1440, 1490, 1390, 1380, 1220, 1220, 1220, 1220, 1220, 1390, 1340, 1380, 1420, 1440, 1470, 1480, 1470, 1470, 1450, 1410, 1410, 1390, 1340, 1280, 1240, 1220, 1220, 1280, 1300, 1340, 1380, 1420, 1440, 1470, 1480, 1470, 1470, 1450, 1410, 1410, 1390, 1340, 1280, 1240, 1220, 1220, 1220, 1270, 1320, 1370, 1420, 1470, 1370, 1360, 1240, 1240, 1240, 1240, 1240, 1400, 1350, 1390, 1430, 1440, 1480, 1490, 1480, 1480, 1460, 1420, 1430, 1400, 1330, 1270, 1230, 1210, 1200, 1300, 1310, 1350, 1390, 1430, 1440, 1480, 1490, 1480, 1480, 1460, 1420, 1430, 1400, 1330, 1270, 1230, 1210, 1200, 1210, 1260, 1310, 1360, 1410, 1460, 1360, 1340, 1260, 1260, 1260, 1260, 1260, 1410, 1420, 1440, 1440, 1440, 1490, 1500, 1490, 1490, 1450, 1430, 1450, 1410, 1320, 1260, 1220, 1200, 1190, 1320, 1380, 1420, 1440, 1440, 1440, 1490, 1500, 1490, 1490, 1450, 1430, 1450, 1410, 1320, 1260, 1220, 1200, 1190, 1200, 1250, 1300, 1350, 1400, 1450, 1350, 1320, 1300, 1300, 1300, 1300, 1300, 1420, 1420, 1440, 1440, 1440, 1490, 1500, 1490, 1490, 1450, 1430, 1530, 1420, 1310, 1250, 1210, 1200, 1190, 1330, 1380, 1420, 1440, 1440, 1440, 1490, 1500, 1490, 1490, 1450, 1430, 1530, 1420, 1310, 1250, 1210, 1200, 1190, 1180, 1170, 1160, 1150, 1140, 1440, 1390, 1340, 1360, 1360, 1360, 1360, 1360, 1440, 1420, 1440, 1440, 1440, 1420, 1420, 1380, 1480, 1430, 1440, 1420, 1420, 1300, 1240, 1240, 1250, 1250, 1350, 1380, 1420, 1440, 1440, 1440, 1420, 1420, 1380, 1480, 1430, 1440, 1420, 1420, 1300, 1240, 1240, 1250, 1250, 1240, 1230, 1230, 1230, 1280, 1430, 1330, 1280, 1420, 1420, 1420, 1420, 1420, 1460, 1410, 1430, 1430, 1430, 1410, 1410, 1370, 1460, 1420, 1330, 1410, 1410, 1290, 1230, 1250, 1300, 1290, 1370, 1370, 1410, 1430, 1430, 1430, 1410, 1410, 1370, 1460, 1420, 1330, 1410, 1410, 1290, 1230, 1250, 1300, 1290, 1280, 1270, 1270, 1320, 1370, 1420, 1320, 1260, 1480, 1480, 1480, 1480, 1480, 1480, 1400, 1420, 1420, 1420, 1400, 1400, 1360, 1420, 1410, 1360, 1400, 1400, 1390, 1370, 1350, 1330, 1310, 1390, 1360, 1400, 1420, 1420, 1420, 1400, 1400, 1360, 1420, 1410, 1360, 1400, 1400, 1390, 1370, 1350, 1330, 1310, 1300, 1290, 1280, 1320, 1370, 1420, 1310, 1250, 1420, 1420, 1420, 1420, 1420, 1500, 1440, 1460, 1460, 1460, 1440, 1440, 1400, 1400, 1400, 1400, 1440, 1400, 1390, 1370, 1350, 1330, 1310, 1400, 1400, 1440, 1460, 1460, 1460, 1440, 1440, 1400, 1400, 1400, 1400, 1440, 1400, 1390, 1370, 1350, 1330, 1310, 1300, 1290, 1280, 1270, 1260, 1410, 1310, 1240, 1360, 1360, 1360, 1360, 1360, 1520, 1480, 1500, 1500, 1500, 1480, 1480, 1440, 1380, 1390, 1440, 1480, 1440, 1430, 1410, 1390, 1370, 1350, 1420, 1440, 1480, 1500, 1500, 1500, 1480, 1480, 1440, 1380, 1390, 1440, 1480, 1440, 1430, 1410, 1390, 1370, 1350, 1340, 1330, 1320, 1310, 1300, 1410, 1300, 1230, 1300, 1300, 1300, 1300, 1300, 1500, 1520, 1540, 1540, 1540, 1520, 1520, 1480, 1360, 1400, 1480, 1520, 1480, 1470, 1450, 1430, 1410, 1390, 1440, 1480, 1520, 1540, 1540, 1540, 1520, 1520, 1480, 1360, 1400, 1480, 1520, 1480, 1470, 1450, 1430, 1410, 1390, 1380, 1370, 1360, 1350, 1340, 1400, 1300, 1220, 1260, 1260, 1260, 1260, 1260, 1480, 1560, 1580, 1580, 1580, 1560, 1560, 1520, 1360, 1440, 1520, 1560, 1520, 1510, 1490, 1470, 1450, 1430, 1460, 1520, 1560, 1580, 1580, 1580, 1560, 1560, 1520, 1360, 1440, 1520, 1560, 1520, 1510, 1490, 1470, 1450, 1430, 1420, 1410, 1400, 1390, 1380, 1340, 1300, 1210, 1240, 1240, 1240, 1240, 1240, 1460, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1470, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1330, 1290, 1200, 1220, 1220, 1220, 1220, 1220, 1400, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1490, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1320, 1290, 1280, 1200, 1200, 1200, 1200, 1200, 1340, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1510, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1310, 1300, 1290, 1230, 1230, 1230, 1230, 1230, 1280, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1520, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1300, 1320, 1310, 1260, 1260, 1260, 1260, 1260, 1290, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1540, 1580, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1340, 1330, 1300, 1300, 1300, 1300, 1300, 1300, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1560, 1580, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1360, 1350, 1300, 1300, 1300, 1300, 1300, 1310, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1580, 1580, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1380, 1370, 1300, 1300, 1300, 1300, 1300, 1320, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1590, 1580, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1330, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1610, 1580, 1610, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1340, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1630, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1350, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1650, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1350, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1660, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1350, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1680, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1350, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1700, 1560, 1600, 1620, 1620, 1620, 1600, 1600, 1560, 1400, 1480, 1560, 1600, 1560, 1550, 1530, 1510, 1490, 1470, 1460, 1450, 1440, 1430, 1420, 1410, 1400, 1390, 1300, 1300, 1300, 1300, 1300, 1350
} ; /* End of table 'lambdaROM[]' - injector duration f( engSpeed, airIntake )*/

static const varsize warmupROM[] = {        
    340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 165, 160, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 165, 160, 155, 150, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 258, 228, 224, 220, 216, 212, 208, 204, 203, 202, 201, 200, 194, 190, 184, 180, 177, 171, 167, 162, 158, 148, 144, 140, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 249, 222, 217, 213, 187, 184, 181, 181, 181, 181, 181, 181, 181, 180, 173, 170, 169, 163, 159, 154, 151, 143, 140, 130, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 216, 211, 206, 182, 176, 171, 166, 166, 166, 166, 166, 166, 166, 162, 160, 160, 154, 151, 146, 144, 137, 135, 127, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 231, 210, 204, 200, 176, 169, 161, 161, 161, 161, 161, 161, 161, 151, 151, 144, 144, 144, 144, 138, 138, 132, 131, 124, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 222, 204, 197, 193, 171, 161, 151, 144, 144, 144, 144, 144, 144, 144, 144, 137, 137, 137, 136, 130, 132, 127, 126, 121, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 213, 198, 191, 186, 165, 153, 141, 129, 128, 128, 128, 128, 128, 128, 128, 126, 126, 126, 126, 126, 126, 120, 120, 120, 200, 201, 202, 202, 203, 204, 205, 206, 206, 207, 208, 209, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 204, 190, 180, 179, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 190, 192, 194, 196, 198, 200, 202, 204, 206, 208, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 180, 182, 184, 186, 188, 190, 192, 194, 196, 198, 200, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 170, 173, 175, 178, 180, 183, 185, 188, 190, 193, 195, 198, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 160, 163, 165, 168, 170, 173, 175, 178, 180, 183, 185, 188, 190, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 150, 154, 157, 161, 164, 168, 171, 175, 178, 182, 185, 189, 192, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 140, 145, 149, 154, 158, 163, 167, 172, 176, 181, 185, 190, 194, 199, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 130, 136, 141, 147, 152, 158, 163, 169, 174, 180, 185, 191, 196, 202, 207, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 126, 132, 138, 144, 150, 156, 162, 168, 174, 180, 186, 192, 198, 204, 208, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 110, 116, 122, 128, 134, 140, 146, 152, 158, 164, 170, 176, 182, 188, 194, 194, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 183, 174, 164, 160, 150, 140, 130, 120, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 100, 105, 110, 115, 120, 125, 130, 135, 140, 145, 150, 155, 160, 165, 170, 175, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 166, 158, 148, 145, 136, 127, 118, 109, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 90, 95, 100, 105, 110, 115, 120, 125, 130, 135, 140, 145, 150, 155, 156, 156, 156, 156, 156, 156, 156, 156, 156, 156, 156, 156, 149, 142, 132, 130, 122, 114, 106, 98, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 80, 85, 90, 95, 100, 105, 110, 115, 120, 125, 130, 135, 140, 145, 150, 150, 150, 138, 138, 138, 138, 138, 138, 138, 138, 138, 132, 126, 116, 115, 108, 101, 94, 87, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 70, 74, 78, 82, 86, 90, 94, 98, 102, 106, 110, 114, 118, 122, 126, 124, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 115, 110, 100, 100, 94, 88, 82, 76, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 70, 60, 63, 66, 69, 72, 75, 78, 81, 84, 87, 90, 93, 96, 99, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 98, 94, 84, 85, 80, 75, 70, 65, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 50, 53, 56, 59, 62, 65, 68, 71, 74, 77, 80, 83, 86, 89, 92, 92, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 81, 78, 68, 70, 66, 62, 58, 54, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 40, 43, 46, 49, 52, 55, 58, 61, 64, 67, 70, 73, 76, 79, 82, 78, 70, 66, 66, 66, 66, 66, 66, 66, 66, 66, 64, 62, 52, 55, 52, 49, 46, 43, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 40, 30, 32, 34, 36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 58, 58, 48, 48, 48, 48, 48, 48, 48, 48, 48, 47, 46, 36, 40, 38, 36, 34, 32, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 30, 20, 25, 24, 23, 22, 21, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10
} ; /* End of table 'warmupROM[]' - injector duration compensation f( engSpeed, airIntake )*/

static const varsize advanceROM[] = {        
    10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 60, 70, 80, 90, 100, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 110, 100, 90, 80, 70, 60, 50, 40, 39, 38, 37, 36, 35, 35, 35, 35, 35, 35, 60, 45, 50, 50, 55, 55, 56, 56, 56, 56, 56, 56, 50, 50, 50, 50, 50, 50, 50, 60, 70, 80, 90, 100, 100, 100, 100, 100, 100, 100, 100, 100, 100, 103, 90, 80, 72, 66, 60, 52, 44, 38, 32, 28, 27, 35, 35, 35, 35, 35, 60, 30, 40, 40, 50, 54, 54, 54, 54, 54, 54, 54, 40, 40, 40, 40, 40, 40, 40, 50, 60, 70, 86, 90, 91, 92, 91, 90, 89, 89, 90, 92, 94, 94, 91, 74, 64, 63, 62, 54, 46, 40, 34, 29, 28, 35, 35, 35, 35, 35, 60, 15, 30, 30, 40, 50, 51, 51, 51, 51, 51, 51, 30, 30, 40, 50, 60, 70, 76, 80, 86, 90, 94, 98, 99, 100, 99, 98, 97, 97, 98, 100, 102, 102, 92, 82, 72, 70, 64, 56, 48, 42, 36, 30, 29, 35, 35, 35, 35, 35, 60, 10, 20, 20, 30, 40, 50, 50, 50, 50, 50, 50, 56, 62, 68, 74, 80, 84, 88, 92, 96, 100, 104, 108, 109, 110, 109, 108, 107, 107, 108, 110, 112, 112, 102, 92, 82, 72, 67, 59, 51, 47, 43, 41, 39, 37, 37, 37, 37, 37, 60, 10, 20, 20, 30, 40, 50, 50, 50, 50, 50, 50, 56, 62, 68, 74, 80, 86, 92, 98, 102, 106, 110, 114, 115, 116, 115, 114, 113, 113, 114, 116, 118, 118, 108, 98, 88, 80, 70, 62, 54, 49, 45, 43, 41, 39, 39, 39, 39, 39, 100, 12, 20, 20, 30, 40, 50, 50, 50, 50, 50, 50, 56, 62, 68, 74, 80, 86, 92, 98, 104, 108, 112, 116, 117, 118, 117, 116, 115, 115, 116, 118, 120, 120, 110, 100, 90, 80, 72, 64, 56, 52, 48, 46, 44, 42, 42, 42, 42, 42, 100, 15, 20, 20, 30, 40, 50, 50, 50, 50, 50, 50, 56, 62, 68, 74, 80, 86, 92, 98, 104, 108, 112, 116, 117, 118, 117, 116, 115, 115, 116, 118, 120, 120, 110, 100, 90, 78, 75, 67, 59, 54, 49, 47, 45, 43, 43, 43, 43, 43, 100, 20, 20, 20, 30, 40, 50, 50, 50, 50, 50, 50, 56, 62, 68, 74, 80, 86, 92, 98, 103, 107, 111, 115, 116, 117, 116, 115, 114, 114, 115, 117, 119, 119, 109, 99, 88, 78, 75, 67, 59, 54, 49, 47, 45, 43, 43, 43, 43, 43, 100, 22, 22, 22, 32, 42, 52, 52, 52, 52, 52, 52, 58, 64, 70, 76, 84, 90, 96, 102, 102, 106, 110, 114, 115, 116, 115, 114, 113, 113, 114, 116, 118, 118, 108, 98, 88, 78, 75, 70, 59, 54, 49, 47, 45, 43, 43, 43, 43, 43, 100, 24, 24, 24, 34, 44, 54, 54, 54, 54, 54, 54, 60, 66, 72, 78, 84, 90, 96, 102, 104, 108, 112, 116, 117, 118, 117, 116, 115, 115, 116, 118, 120, 120, 110, 100, 86, 86, 78, 75, 67, 59, 54, 49, 47, 44, 44, 44, 44, 44, 100, 30, 30, 30, 40, 50, 60, 60, 60, 60, 60, 60, 66, 72, 78, 84, 90, 96, 102, 108, 112, 116, 120, 124, 125, 126, 125, 124, 123, 123, 124, 124, 122, 120, 118, 108, 88, 88, 78, 75, 67, 59, 54, 49, 47, 44, 44, 44, 44, 44, 100, 30, 30, 30, 40, 50, 60, 60, 60, 60, 60, 60, 66, 72, 78, 84, 90, 96, 102, 116, 120, 124, 128, 132, 133, 134, 133, 132, 131, 131, 132, 130, 127, 124, 121, 116, 92, 92, 76, 68, 60, 56, 52, 50, 48, 46, 46, 46, 46, 46, 100, 30, 30, 30, 40, 50, 60, 60, 60, 60, 60, 60, 66, 72, 78, 84, 90, 96, 104, 118, 122, 126, 130, 134, 135, 136, 135, 134, 133, 133, 133, 131, 128, 107, 106, 104, 92, 92, 76, 68, 60, 56, 52, 50, 48, 46, 46, 46, 46, 46, 100, 31, 31, 31, 41, 51, 61, 61, 61, 61, 61, 61, 67, 73, 79, 85, 91, 97, 103, 120, 124, 128, 132, 136, 137, 138, 137, 136, 135, 134, 134, 132, 129, 107, 106, 104, 92, 92, 76, 68, 60, 56, 52, 50, 48, 46, 46, 46, 46, 46, 100, 33, 33, 33, 43, 53, 63, 63, 63, 63, 63, 63, 69, 75, 81, 87, 93, 99, 105, 122, 126, 130, 134, 138, 139, 140, 139, 138, 137, 135, 135, 133, 130, 108, 107, 104, 94, 94, 77, 72, 66, 60, 72, 75, 70, 66, 66, 66, 66, 66, 100, 35, 35, 35, 45, 55, 65, 65, 65, 65, 65, 65, 71, 77, 83, 88, 96, 100, 107, 124, 128, 132, 136, 140, 141, 142, 141, 140, 139, 136, 136, 134, 131, 108, 107, 105, 94, 94, 77, 76, 72, 70, 92, 100, 105, 86, 86, 86, 86, 86, 100, 35, 35, 35, 45, 55, 65, 65, 65, 65, 65, 65, 67, 69, 71, 77, 83, 89, 95, 126, 130, 134, 138, 142, 143, 144, 143, 142, 141, 137, 137, 135, 132, 109, 108, 107, 106, 105, 105, 104, 108, 112, 116, 120, 120, 106, 106, 106, 106, 106, 100, 35, 35, 35, 45, 55, 65, 65, 65, 65, 65, 65, 65, 65, 65, 71, 81, 91, 101, 127, 131, 135, 139, 143, 144, 145, 144, 144, 142, 138, 138, 136, 133, 131, 127, 125, 122, 120, 125, 130, 135, 140, 145, 140, 108, 116, 116, 116, 116, 116, 100, 38, 38, 38, 48, 58, 68, 68, 68, 68, 68, 68, 68, 68, 68, 74, 84, 94, 104, 128, 132, 136, 140, 143, 145, 146, 145, 145, 143, 139, 139, 137, 134, 130, 126, 124, 126, 130, 135, 140, 145, 150, 155, 150, 140, 120, 120, 120, 120, 120, 100, 41, 41, 41, 51, 61, 71, 71, 71, 71, 71, 71, 71, 71, 71, 77, 87, 97, 107, 129, 133, 137, 141, 143, 146, 147, 146, 146, 144, 140, 140, 138, 135, 129, 125, 123, 122, 124, 129, 134, 139, 144, 149, 139, 138, 122, 122, 122, 122, 122, 100, 44, 44, 44, 54, 64, 74, 74, 74, 74, 74, 74, 74, 74, 74, 80, 90, 100, 110, 130, 134, 138, 142, 144, 147, 148, 147, 147, 145, 141, 141, 139, 134, 128, 124, 122, 122, 122, 127, 132, 137, 142, 147, 137, 136, 124, 124, 124, 124, 124, 100, 47, 47, 47, 57, 67, 77, 77, 77, 77, 77, 77, 77, 77, 77, 87, 97, 107, 117, 131, 135, 139, 143, 144, 148, 149, 148, 148, 146, 142, 143, 140, 133, 127, 123, 121, 120, 121, 126, 131, 136, 141, 146, 136, 134, 126, 126, 126, 126, 126, 100, 45, 45, 45, 55, 65, 75, 75, 75, 75, 75, 75, 75, 78, 88, 98, 108, 118, 128, 138, 142, 144, 144, 144, 149, 150, 149, 149, 145, 143, 145, 141, 132, 126, 122, 120, 119, 120, 125, 130, 135, 140, 145, 135, 132, 130, 130, 130, 130, 130, 100, 43, 43, 43, 53, 63, 73, 73, 73, 73, 73, 73, 76, 79, 89, 109, 108, 118, 128, 138, 142, 144, 144, 144, 149, 150, 149, 149, 145, 143, 153, 142, 131, 125, 121, 120, 119, 118, 117, 116, 115, 114, 144, 139, 134, 136, 136, 136, 136, 136, 100, 42, 42, 42, 52, 62, 72, 72, 72, 72, 72, 72, 75, 78, 88, 98, 108, 118, 128, 138, 142, 144, 144, 144, 142, 142, 138, 148, 143, 144, 142, 142, 130, 124, 124, 125, 125, 124, 123, 123, 123, 128, 143, 133, 128, 142, 142, 142, 142, 142, 100, 41, 41, 41, 51, 61, 71, 71, 71, 71, 71, 71, 74, 77, 87, 97, 107, 117, 127, 137, 141, 143, 143, 143, 141, 141, 137, 146, 142, 133, 141, 141, 129, 123, 125, 130, 129, 128, 127, 127, 132, 137, 142, 132, 126, 148, 148, 148, 148, 148, 100, 40, 40, 40, 50, 60, 70, 70, 70, 70, 70, 70, 73, 76, 86, 96, 106, 116, 126, 136, 140, 142, 142, 142, 140, 140, 136, 142, 141, 136, 140, 140, 139, 137, 135, 133, 131, 130, 129, 128, 132, 137, 142, 131, 125, 142, 142, 142, 142, 142, 100, 46, 46, 46, 56, 66, 76, 76, 76, 76, 76, 76, 84, 92, 100, 108, 116, 124, 132, 140, 144, 146, 146, 146, 144, 144, 140, 140, 140, 140, 144, 140, 139, 137, 135, 133, 131, 130, 129, 128, 127, 126, 141, 131, 124, 136, 136, 136, 136, 136, 100, 50, 50, 50, 60, 70, 80, 80, 80, 80, 80, 80, 88, 96, 104, 112, 120, 128, 136, 144, 148, 150, 150, 150, 148, 148, 144, 138, 139, 144, 148, 144, 143, 141, 139, 137, 135, 134, 133, 132, 131, 130, 141, 130, 123, 130, 130, 130, 130, 130, 100, 54, 54, 54, 64, 74, 84, 84, 84, 84, 84, 84, 92, 100, 108, 116, 124, 132, 140, 148, 152, 154, 154, 154, 152, 152, 148, 136, 140, 148, 152, 148, 147, 145, 143, 141, 139, 138, 137, 136, 135, 134, 140, 130, 122, 126, 126, 126, 126, 126, 100, 58, 58, 58, 68, 78, 88, 88, 88, 88, 88, 88, 96, 104, 112, 120, 128, 136, 144, 152, 156, 158, 158, 158, 156, 156, 152, 136, 144, 152, 156, 152, 151, 149, 147, 145, 143, 142, 141, 140, 139, 138, 134, 130, 121, 124, 124, 124, 124, 124, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 133, 129, 120, 122, 122, 122, 122, 122, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 132, 129, 128, 120, 120, 120, 120, 120, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 131, 130, 129, 123, 123, 123, 123, 123, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 130, 132, 131, 126, 126, 126, 126, 126, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 134, 133, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 136, 135, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 138, 137, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100, 62, 62, 62, 72, 82, 92, 92, 92, 92, 92, 92, 100, 108, 116, 124, 132, 140, 148, 156, 160, 162, 162, 162, 160, 160, 156, 140, 148, 156, 160, 156, 155, 153, 151, 149, 147, 146, 145, 144, 143, 142, 141, 140, 139, 130, 130, 130, 130, 130, 100
} ; /* End of table 'advanceROM[]' - ignition advance f( engSpeed, airIntake )*/

static const varsize batteryROM[] = {        
    80, 82, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114, 116, 118, 120, 122, 124, 126, 128, 130, 132, 134, 136, 138, 140, 142, 144, 146, 148, 150, 152, 154, 156, 158, 160, 162, 164, 166, 168, 170, 172, 174, 176, 178
} ; /* End of table 'batteryROM' - x axis for 'dwellROM' */

static const varsize dwellROM[] = {        
    10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 30, 20, 25, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 23, 23, 23, 23, 12, 12, 12, 12, 12, 12, 12, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 48, 47, 46, 36, 40, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 38, 34, 34, 34, 34, 34, 34, 34, 34, 33, 31, 31, 31, 18, 18, 18, 18, 18, 18, 18, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 64, 62, 52, 55, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 52, 44, 44, 44, 44, 44, 44, 44, 44, 43, 39, 39, 39, 24, 24, 24, 24, 24, 24, 24, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 84, 81, 78, 68, 70, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 66, 54, 54, 54, 54, 54, 54, 54, 54, 53, 47, 47, 47, 30, 30, 30, 30, 30, 30, 30, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 102, 98, 94, 84, 85, 80, 75, 70, 65, 60, 60, 60, 60, 60, 60, 92, 84, 78, 74, 71, 71, 67, 67, 64, 64, 64, 61, 60, 58, 57, 56, 56, 51, 51, 51, 36, 36, 36, 36, 36, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 115, 110, 100, 100, 94, 88, 82, 76, 70, 70, 70, 70, 70, 70, 94, 86, 81, 77, 75, 75, 71, 71, 68, 68, 68, 65, 64, 63, 62, 60, 60, 56, 56, 56, 42, 42, 42, 42, 42, 138, 138, 138, 138, 138, 138, 138, 138, 138, 138, 138, 132, 126, 116, 115, 108, 101, 94, 87, 80, 80, 80, 80, 80, 80, 96, 89, 84, 80, 78, 78, 74, 74, 72, 72, 72, 70, 68, 67, 66, 65, 65, 61, 61, 61, 48, 48, 48, 48, 48, 156, 156, 156, 156, 156, 156, 156, 156, 156, 156, 156, 149, 142, 132, 130, 122, 114, 106, 98, 90, 90, 90, 90, 90, 90, 98, 91, 87, 84, 82, 82, 78, 78, 76, 76, 76, 74, 73, 72, 71, 69, 69, 66, 66, 66, 54, 54, 54, 54, 54, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 174, 166, 158, 148, 145, 136, 127, 118, 109, 100, 100, 100, 100, 100, 100, 100, 94, 90, 87, 85, 85, 82, 82, 80, 80, 80, 78, 77, 76, 75, 74, 74, 71, 71, 71, 60, 60, 60, 60, 60, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 192, 183, 174, 164, 160, 150, 140, 130, 120, 110, 102, 102, 102, 102, 102, 102, 97, 93, 90, 89, 89, 86, 86, 84, 84, 84, 82, 81, 80, 80, 79, 79, 76, 76, 76, 66, 66, 66, 66, 66, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 104, 104, 104, 104, 104, 104, 99, 96, 94, 92, 92, 90, 90, 88, 88, 88, 86, 86, 85, 84, 83, 83, 81, 81, 81, 72, 72, 72, 72, 72, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 106, 106, 106, 106, 106, 106, 102, 99, 97, 96, 96, 93, 93, 92, 92, 92, 91, 90, 89, 89, 88, 88, 86, 86, 86, 78, 78, 78, 78, 78, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 108, 108, 108, 108, 108, 108, 104, 102, 100, 99, 99, 97, 97, 96, 96, 96, 95, 94, 94, 93, 92, 92, 91, 91, 91, 84, 84, 84, 84, 84, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 110, 110, 110, 110, 110, 110, 107, 105, 104, 103, 103, 101, 101, 100, 100, 100, 99, 99, 98, 98, 97, 97, 96, 96, 96, 90, 90, 90, 90, 90, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 112, 112, 112, 112, 112, 112, 110, 108, 107, 106, 106, 105, 105, 104, 104, 104, 103, 103, 102, 102, 102, 102, 100, 100, 100, 96, 96, 96, 96, 96, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 114, 114, 114, 114, 114, 114, 112, 111, 110, 110, 110, 109, 109, 108, 108, 108, 107, 107, 107, 107, 106, 106, 105, 105, 105, 102, 102, 102, 102, 102, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 116, 116, 116, 116, 116, 116, 115, 114, 113, 113, 113, 112, 112, 112, 112, 112, 112, 111, 111, 111, 111, 111, 110, 110, 110, 108, 108, 108, 108, 108, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 200, 190, 180, 170, 160, 150, 140, 130, 120, 118, 118, 118, 118, 118, 118, 117, 117, 117, 117, 117, 116, 116, 116, 116, 116, 116, 116, 116, 116, 115, 115, 115, 115, 115, 114, 114, 114, 114, 114, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 204, 190, 180, 179, 160, 150, 140, 130, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 120, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 210, 213, 198, 210, 200, 165, 153, 141, 129, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 126, 126, 126, 126, 126, 126, 120, 120, 120, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 220, 212, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 161, 151, 144, 144, 144, 144, 144, 144, 144, 144, 137, 137, 137, 136, 130, 132, 127, 126, 121, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 230, 224, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 169, 161, 161, 161, 161, 161, 161, 161, 151, 151, 144, 144, 144, 144, 138, 138, 132, 131, 124, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 240, 236, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 176, 171, 166, 166, 166, 166, 166, 166, 166, 162, 160, 160, 154, 151, 146, 144, 137, 135, 127, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 250, 248, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 181, 181, 181, 181, 181, 181, 181, 180, 173, 170, 169, 163, 159, 154, 151, 143, 140, 130, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 260, 228, 228, 228, 228, 228, 228, 228, 228, 228, 228, 228, 224, 220, 216, 212, 208, 204, 203, 202, 201, 200, 194, 190, 184, 180, 177, 171, 167, 162, 158, 148, 144, 140, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 165, 160, 155, 150, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 165, 160, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 290, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 175, 170, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 185, 180, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 195, 190, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 205, 200, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 215, 210, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 340, 335, 330, 325, 320, 315, 310, 305, 300, 295, 290, 285, 280, 275, 270, 265, 260, 255, 250, 245, 240, 235, 230, 225, 220
} ;    /* End of table 'dwellROM[]' - ignition dwell f( engSpeed, battery )*/


static const varsize eTempAxisROM[] = {        
    - 40, - 38, - 35, - 33, - 30, - 28, - 25, - 23, - 20, - 18, - 15, - 13, - 10, - 8, - 5, - 3, 0, 3, 5, 8, 10, 13, 15, 18, 20, 23, 25, 28, 30, 33, 35, 38, 40, 43, 45, 48, 50, 53, 55, 58, 60, 63, 65, 68, 70, 73, 75, 78, 80, 83
} ; /* End of table 'eTempAxisROM' - x axis for 'engWarmROM' and 'engTempROM' */

static const varsize engWarmROM[] = {        
    190, 188, 186, 185, 183, 181, 179, 177, 176, 172, 169, 165, 162, 158, 155, 151, 148, 144, 141, 137, 134, 130, 127, 123, 120, 118, 115, 114, 112, 111, 110, 109, 108, 107, 106, 105, 105, 104, 104, 103, 103, 103, 103, 102, 102, 101, 101, 101, 100, 100
} ;    /* End of table 'engWarmROM' - injector ocmpensation f( engTemp )*/


static const varsize engTempROM[] = {        
    0, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200, 210, 220, 230, 240, 250, 260, 270, 280, 290, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410, 420, 430, 440, 450, 460, 470, 480, 490, 500
} ;    /* End of table 'engTempROM' - ignition advance compensation f( engTemp )*/


static const varsize aTempAxisROM[] = {        
    - 40, - 38, - 35, - 33, - 30, - 28, - 25, - 23, - 20, - 18, - 15, - 13, - 10, - 8, - 5, - 3, 0, 3, 5, 8, 10, 13, 15, 18, 20, 23, 25, 28, 30, 33, 35, 38, 40, 43, 45, 48, 50, 53, 55, 58, 60, 63, 65, 68, 70, 73, 75, 78, 80, 83
} ; /* End of table 'aTempAxisROM' - x axis for 'airTempROM' */

static const varsize airTempROM[] = {        
    107, 107, 107, 107, 107, 107, 106, 106, 106, 105, 105, 105, 104, 104, 104, 103, 103, 102, 102, 102, 101, 101, 101, 100, 100, 100, 99, 99, 99, 98, 98, 98, 97, 97, 97, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96, 96
} ; /* End of table 'airTempROM' - injector compensation f( airTemp )*/

static const varsize voltAxisROM[] = {        
    60, 62, 65, 67, 70, 72, 74, 77, 79, 82, 84, 86, 89, 91, 94, 96, 98, 101, 103, 106, 108, 110, 113, 115, 118, 120, 122, 125, 127, 130, 132, 134, 137, 139, 142, 144, 146, 149, 151, 154, 156, 158, 161, 163, 166, 168, 170, 173, 175, 178
} ; /* End of table 'voltAxisROM' - x axis for 'voltROM' */

static const varsize voltROM[] = {        
    750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 750, 732, 714, 696, 678, 660, 642, 624, 606, 588, 570, 552, 534, 516, 498, 480, 462, 444, 426, 408, 390, 372, 354, 336, 318, 300, 300, 300, 300, 300, 300, 300, 300
} ; /* End of table 'voltROM' - injector compensation f( battery ) */

static const varsize accelROM[] = {        
    50, 50, 50, 50, 50, 49, 48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5
} ; /* End of table 'accelROM' - injector compensation f( engTemp )*/



// #ifndef RANDOM_FUNCTION_GENERATOR
// int main(void) {
//     t_run_test(0, NULL);

//     // stop the program
//     asm("wfi");
//     return 0;
// }
// #endif

static varsize ZTableLookup( varsize, varsize, n_long, n_long, const varsize *, 
                      const varsize *, const varsize * ) ; 
static varsize YTableLookup( varsize, n_long, const varsize *, const varsize * ) ; 

static const varsize inpValueROM[] ;    /* Source of the test data, in "ROM" */
static const varsize airIntakeROM[] ;   /* The tables are in "ROM" */
static const varsize engSpeedROM[] ; 
static const varsize lambdaROM[] ; 
static const varsize warmupROM[] ; 
static const varsize advanceROM[] ; 
static const varsize batteryROM[] ; 
static const varsize dwellROM[] ; 
static const varsize eTempAxisROM[] ; 
static const varsize engWarmROM[] ; 
static const varsize engTempROM[] ; 
static const varsize aTempAxisROM[] ; 
static const varsize airTempROM[] ; 
static const varsize voltAxisROM[] ; 
static const varsize voltROM[] ; 
static const varsize accelROM[] ; 

static n_int   *RAMfile ;          /* Pointer to test output RAM file */
static n_int   *RAMfilePtr ;       /* Pointer to position in output RAM file */
static n_int   RAMfileSize ;       /* Size of the debug output RAM file */
static n_int   tableCount ;        /* Number of passes through table */
static n_int   *RAMfileEOF;        /* points to end of RAM file */
static n_int   RAMfile_increment;  /* difference between varsize and n_int */

/* INPUT VARIABLES : presented in the test data */    

static varsize tonewheelTeeth ;    /* Number of teeth on the tonewheel */
static varsize engSpeed ;          /* Engine speed( RPM's )expressed in ECU units */
static varsize angleTime ;         /* Crankshaft angle expressed at ECU time */
static varsize airIntake ;         /* Intake-air volume( measure of engine load )*/
static varsize airTemp ;           /* Intake-air temperature */
static varsize engTemp ;           /* Engine coolant temperature */
static varsize battery ;           /* Vehicle battery voltage */
static varsize throttle ;          /* Throttle position */
static varsize lastThrottle ;      /* Previous throttle position */
static n_int knocked ;               /* Engine knock has been detected */
static n_int cranking ;              /* We're starting the engine */

static const varsize *engSpeedAxis ;  /* Linear array of 'y' axis */
static const varsize *airIntakeAxis ; /* Linear array of 'x' axis */
static const varsize *batteryAxis ;   /* Linear array of 'x' axis */
static const varsize *lambdaTbl ;     /* Y array of f( x, y )= 'lambda' */
static const varsize *warmupTbl ;     /* Y array of f( x, y )= 'warmup' */
static const varsize *advanceTbl ;    /* Y array of f( x, y )= 'advance' */
static const varsize *dwellTbl ;      /* Y array of f( x, y )= 'dwell' */
static const varsize *voltAxis ;      /* 'x' axis for 'voltTbl' */
static const varsize *voltTbl ;       /* 'y' axis, injector compensation */
static const varsize *aTempAxis ;     /* 'x' axis for 'airTempTbl' */
static const varsize *airTempTbl ;    /* 'y' axis, injector compensation */
static const varsize *eTempAxis ;     /* 'x' axis for 'engWarmTbl' and 'engTempTbl' */
static const varsize *engWarmTbl ;    /* 'y' axis, injector compensation */
static const varsize *engTempTbl ;    /* 'y' axis, ignition advance compensation */
static const varsize *accelTbl ;      /* 'y' axis, injector compensation */

static n_long voltEntries ;             /* Number of entries in each table */
static n_long eTempEntries ; 
static n_long aTempEntries ; 
static n_long loadEntries ; 
static n_long speedEntries ; 
static n_long battEntries ; 

/* >> IMPORTANT NOTE << 
*
* Since benchmarks can be entered( run )multiple times, the benchmark
* MUST NOT depend on global data being initialized.  E.g. it must
* complelty initialize itself EVERY TIME its t_run_test()function
* is called.
* 
*/    

static varsize *engSpeedValue ;  /* Test data input variable table for 'engSpeed' */
static varsize *angleTimeValue ; /* Test data input variable table for 'angleTime' */
static varsize *airIntakeValue ; /* Test data input variable table for 'airIntake' */
static varsize *airTempValue ;   /* Test data input variable table for 'airTemp' */
static varsize *engTempValue ;   /* Test data input variable table for 'engTemp' */
static varsize *batteryValue ;   /* Test data input variable table for 'battery' */
static varsize *throttleValue ;  /* Test data input variable table for 'throttle' */
static n_int *knockedValue ;       /* Test data input variable table for 'knocked' */
static n_int *crankingValue ;      /* Test data input variable table for 'cranking' */

static int input_index;

static int t_run_test(int argc, const char *argv[] )
{    
    int iterations = 1;
    input_index = atoi(argv[0]);
    int inputs_count = NUM_TESTS;
    if (input_index >= inputs_count)
        th_exit("ERROR: input_index %d is out of range, max is %d\nStopping execution.\n", input_index, inputs_count-1);


#if BMDEBUG
    char *szTitle = 
        "\nEEMBC Automotive/Industrial Subcommittee Benchmarks ( c )1998-1999\n"
        "Algorithm 5 :  Tooth-to-Spark  Rev. 1.0H0 - ttsprk01\n" ; 
    char *szHeader = 
        "\neSpeed, angle, airIntake, airTemp, engTemp, battery, "
        "throttle, knock, crank\n[dwell, firingT, inject, advance, retard, "
        "accComp, lambda, injectOn, Pump, Ignition] counter\n" ; 
    char szDebug[100] ; 
#else
    varsize i ; 
#endif /* BMDEBUG */
    static n_char szDataSize[40] ; 
    n_int isTableLooped = false ;    /* Input test data table looped */
    /* Hardware enable for the fuel pump */
    static n_int fuelPump1 ;
    static n_int fuelPump2 ;
    static n_int fuelPump3 ;    
    /* Hardware enable for the igniters */
    static n_int enbIgnition1 ;
    static n_int enbIgnition2 ;
    static n_int enbIgnition3 ; 
    /* The injector( s )is/are on to deliver fuel */
    static n_int injectOn1 ; 
    static n_int injectOn2 ;
    static n_int injectOn3 ;    
    /* History of the 'airIntake' variable */
    static varsize lastAirIntake1 ;
    static varsize lastAirIntake2 ;
    static varsize lastAirIntake3 ;   
    /* History of the 'engSpeed' variable */
    static varsize lastEngSpeed1 ;
    static varsize lastEngSpeed2 ;
    static varsize lastEngSpeed3 ;    
    /* History of the 'throttle' variable */
    static varsize lastThrottle1 ;
    static varsize lastThrottle2 ;
    static varsize lastThrottle3 ;    
    /* Injector duration to control fuel mix */
    static varsize inject1 ;
    static varsize inject2 ;
    static varsize inject3 ;    
    /* Time( angle )to turn on the injector */
    static varsize injectTime1 ;
    static varsize injectTime2 ;
    static varsize injectTime3 ;
    /* Injector compensation for load/speed */
    static varsize lambda1 ;
    static varsize lambda2 ;
    static varsize lambda3 ;    
    /* Injector compensation for battery volts */
    static varsize voltComp1 ;
    static varsize voltComp2 ;
    static varsize voltComp3 ;  
    /* Injector compensation for engine warmup */
    static varsize warmup1 ;
    static varsize warmup2 ;
    static varsize warmup3 ;    
    /* Injector compensation for load/speed( modifies warmup )*/
    static varsize warmupComp1 ;
    static varsize warmupComp2 ;
    static varsize warmupComp3 ;    
    /* Injector compensation for intake-air temp */
    static varsize airTempComp1 ;
    static varsize airTempComp2 ;
    static varsize airTempComp3 ;   
    /* Time( angle )to turn on igniter */
    static varsize firingTime1 ;
    static varsize firingTime2 ;
    static varsize firingTime3 ;    
    /* Igniter on-time duration */
    static varsize dwell1 ;
    static varsize dwell2 ;
    static varsize dwell3 ;    
    /* Igniter advance for load/speed */
    static varsize advance1 ;
    static varsize advance2 ;
    static varsize advance3 ;    
    /* Igniter compensation for engine temp */
    static varsize tempComp1 ;
    static varsize tempComp2 ;
    static varsize tempComp3 ;   
    /* Igniter dwell compensation for battery volts */
    static varsize dwellComp1 ;
    static varsize dwellComp2 ;
    static varsize dwellComp3 ; 
    /* Time( angle )to retard igniter due to knocking */
    static varsize retard1 ;
    static varsize retard2 ;
    static varsize retard3 ;    
    /* Injector compensation for acceleration( change in demand )*/
    static varsize accelComp1 ;
    static varsize accelComp2 ;
    static varsize accelComp3 ;    
    /* Amount to decrease compensation due to acceleration */
    static varsize accelDelta1 ;
    static varsize accelDelta2 ;
    static varsize accelDelta3 ;    

    /* Unused */
    argc = argc ;
    argv = argv ;

    /*
     * First, initialize the data structures we need for the test
     * and allocate memory as needed.  Report an error if we can't.
     *
     */    

    /* Variable initializations at t=0 */    

    /* No engine load history, */
    lastAirIntake1 = 0 ;   
    lastAirIntake2 = 0 ; 
    lastAirIntake3 = 0 ; 
    /*  and no engine speed history */
    lastEngSpeed1 = 0 ;    
    lastEngSpeed2 = 0 ; 
    lastEngSpeed3 = 0 ; 
    /*  and no throttle history */
    lastThrottle1 = 0 ;    
    lastThrottle2 = 0 ; 
    lastThrottle3 = 0 ; 
    /* Don't have to retard due to knock */
    retard1 = 0 ;    
    retard2 = 0 ; 
    retard3 = 0 ; 
    /* Just want to start the delta somewhere */
    accelDelta1 = 0 ;    
    accelDelta2 = 0 ; 
    accelDelta3 = 0 ; 
    /*  and there's been no acceleration */
    accelComp1 = 0 ;    
    accelComp2 = 0 ; 
    accelComp3 = 0 ; 
    /* Set base firing time somewhere */
    firingTime1 = FIRE_TIME_NOM ;    
    firingTime2 = FIRE_TIME_NOM ; 
    firingTime3 = FIRE_TIME_NOM ; 
    /*  and set base dwell time somewhere */
    dwell1 = DWELL_MIN ;    
    dwell2 = DWELL_MIN ; 
    dwell3 = DWELL_MIN ; 
    /*  and set base injector time somewhere */
    injectTime1 = INJECT_TIME_NOM ;    
    injectTime2 = INJECT_TIME_NOM ; 
    injectTime3 = INJECT_TIME_NOM ; 
    /*  and set base injector duration somewhere */
    inject1 = INJECT_MIN ;    
    inject2 = INJECT_MIN ; 
    inject3 = INJECT_MIN ; 
    /* No ignition advance yet */
    advance1 = 0 ;    
    advance2 = 0 ; 
    advance3 = 0 ; 
    /*  and no air/fuel mix */
    lambda1 = 0 ;    
    lambda2 = 0 ; 
    lambda3 = 0 ; 
    /* Hardware enable for the fuel pump */
    fuelPump1 = false ;    
    fuelPump2 = false ; 
    fuelPump3 = false ; 
    /* Hardware enable for the igniters */
    enbIgnition1 = false ;    
    enbIgnition2 = false ; 
    enbIgnition3 = false ; 
    /* The injector( s )is/are on to deliver fuel */
    injectOn1 = false ;    
    injectOn2 = false ; 
    injectOn3 = false ; 
    /* Set base firing time */
    firingTime1 = FIRE_TIME_NOM ;    
    firingTime2 = FIRE_TIME_NOM ; 
    firingTime3 = FIRE_TIME_NOM ; 
    /*  and set base dwell time */
    dwell1 = DWELL_MIN ;    
    dwell2 = DWELL_MIN ; 
    dwell3 = DWELL_MIN ; 
    /*  and set base injector time */
    injectTime1 = INJECT_TIME_NOM ;    
    injectTime2 = INJECT_TIME_NOM ; 
    injectTime3 = INJECT_TIME_NOM ; 
    /*  and set base injector duration */
    inject1 = INJECT_MIN ;    
    inject2 = INJECT_MIN ; 
    inject3 = INJECT_MIN ; 
    tableCount = 0 ;    /* Start out at beginning of input test data */

  
    /* Tell us the compiled data size */    
#if BMDEBUG
    th_sprintf( szDataSize, "Data size = %s\n\n", 
        ( DATA_SIZE ? "LONG" : "SHORT" ) ) ;
#else
#if DATA_SIZE
    szDataSize[0] = 'L' ; 
#else
    szDataSize[0] = 'S' ; 
#endif
    szDataSize[1] = '\0' ; 
#endif /* BMDEBUG */

    /* Initialize the test data -- stimuli for the algorithm. */

    // if( !GetTestData() )   /* Allocate for the test input data table */
    // {
    //     th_exit( THE_OUT_OF_MEMORY, "Cannot Allocate Memory %s : %d",
    //         __FILE__, __LINE__ ) ; 
    // }


#if BMDEBUG
    DebugOut( szTitle ) ;       /* Print the title message in RAM file */
    DebugOut( szDataSize ) ;    /* ...and the data size */
    DebugOut( szHeader ) ;      /* Print the test output file hdr in RAM file */
#endif /* BMDEBUG */

    GetZTables() ;  /* Get the 3D tables into RAM, or point to ROM */
    GetYTables() ;  /* Get the 2D tables into RAM, or point to ROM */

    /* This is the actual benchmark algorithm. */    

    /*
    * Perform tooth-to-spark algorithm : 
    *
    * 1. Get input variables for engine speed, crankshaft position, 
    *    intake air quantity, intake air temperature, engine temperature, 
    *    throttle position, battery voltage.
    *
    * 2. Output to the fuel pump, only when engine is running( engine
    *    speed is present ).
    *
    * 3. Output to the ignition for spark, via 'firingTime'.  This is adjusted
    *    by engine speed, engine load( intake air quantity )and engine temp.
    *    Also may be retarded due to engine knock.
    *
    * 4. Output to the fuel injectors to control fuel flow.  The injector 
    *    duration is adjusted by engine speed, engine load, intake air temp,
    *    acceleration and battery voltage.
    *
    * It is presumed that engine speed and crankshaft position have
    * been developed from the cranshaft tonewheel pulses elsewhere in
    * the controller( see Algorithm #2 ).
    *
    */    

    for( int loop_cnt = 0 ; loop_cnt < iterations  ; loop_cnt++ )
    {

#if BMDEBUG
        if( isTableLooped ) 
        {
            DebugOut( "END--END--END\n" )
        }
#endif /* BMDEBUG */

        /***********************************************************************
            First Pass                                                          
        ***********************************************************************/

        /* Gets a set of input variables from test data*/
        isTableLooped = GetInputValues() ;    

#if BMDEBUG        
        th_sprintf( szDebug, " %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %2d, %2d", 
            (n_long)engSpeed, 
            (n_long)angleTime, 
            (n_long)airIntake, 
            (n_long)airTemp, 
            (n_long)engTemp, 
            (n_long)battery, 
            (n_long)throttle, 
            knocked, 
            cranking ) ; 
        DebugOut( szDebug ) ; 
#endif /* BMDEBUG */

        /* Engine running ? */
        if( engSpeed > 0 )
        {            
            /* Yes, enable fuel pump */
            fuelPump1 = true ;    
            /* ...and allow ignition firing */
            enbIgnition1 = true ;    

            /* Engine just cranking ? */
            if( !cranking )
            {            

                /* No, engine running, but has an engine parameter changed ? */
                if( ( airIntake != lastAirIntake1 ) || 
                    ( engSpeed != lastEngSpeed1 ) || 
                    ( throttle != lastThrottle1 ) )
                {        
                    /* Decelerating engine speed with same or less load ? */
                    /* ...or excessive RPM's ? */
                    if( ( ( engSpeed < lastEngSpeed1 ) &&
                          ( airIntake <= lastAirIntake1 ) ) ||
                          ( engSpeed > ENG_SPEED_MAX ) )
                    {            
                        /* Yes, so no more injection! */
                        inject1 = 0 ;    
                        /* ...and no enrichment for acceleration */
                        accelComp1 = 0 ;    
                    }
                    else 
                    {            
                        /* Else, normal injection */
                    
                        /* 
                         * Compute baseline injector duration from 
                         * load/speed map 
                         *
                         */    

                        lambda1 = ZTableLookup( airIntake, engSpeed, 
                            loadEntries, speedEntries, airIntakeAxis, 
                            engSpeedAxis, lambdaTbl ) ; 
                        
                        inject1 = lambda1 ; 

                        /* 
                         * Enrich based on engine-warmup, compensated by 
                         * warmup load/speed map 
                         *
                         */    

                        warmup1 = YTableLookup( engTemp, eTempEntries, 
                            eTempAxis, engWarmTbl ) ; 
                        
                        warmupComp1 = (varsize)( ( ZTableLookup( airIntake, 
                            engSpeed, loadEntries, speedEntries, 
                            airIntakeAxis, engSpeedAxis, warmupTbl ) * 
                            warmup1 ) / 100 ) ; 

                        inject1 = (varsize)
                            ( ( inject1 * warmupComp1 ) / 100 ) ; 

                        /* Adjust enrichment based on intake-air temperature */    
                        airTempComp1 = YTableLookup( airTemp, aTempEntries,
                            aTempAxis, airTempTbl ) ; 
 
                        inject1 = (varsize)
                            ( ( inject1 * airTempComp1 ) / 100 ) ; 

                        /* Adjust for change in throttle position( demand )*/    
                        if( ( throttle - lastThrottle1 ) > ACCEL_MIN )
                        {            
                            /* Only if accelerating */
                            accelComp1 = YTableLookup( engTemp, eTempEntries,
                                eTempAxis, accelTbl ) ; 
                            accelDelta1 = accelComp1 >> ACCEL_TIME ;                        
                        }
                        else 
                        {            
                            /* Else, maybe compensation is ongoing */
                            if( accelComp1 > 0 )   
                            {
                                /* So, decrease it with ECU time */
                                accelComp1 -= accelDelta1 ; 
                            }

                            if( accelComp1 < 0 )
                            {
                                /* ...until no more compensation */
                                accelComp1 = 0 ;    
                            }
                        }

                        /* ...and compensate for acceleration */        
                        inject1 = (varsize)
                            ( ( inject1 * ( 100 + accelComp1 ) ) / 100 ) ; 
                        
                        /* Adjust injector duration for battery voltage */    
                        voltComp1 = YTableLookup( battery, voltEntries,
                            voltAxis, voltTbl ) ; 

                        inject1 = ( varsize )( inject1 + voltComp1 ) ; 

                        /* Watch out for injector duration maximum limit */    
                        if( inject1 > INJECT_MAX ){
                            inject1 = INJECT_MAX ; 
                        }
                    } /* End of 'normal injection' */

                    /* 
                     * Determine the ignition advance, from engine speed and 
                     * air intake 
                     *
                     */    
                    advance1 = ZTableLookup( airIntake, engSpeed, loadEntries,
                        speedEntries, airIntakeAxis, engSpeedAxis,
                        advanceTbl ) ; 

                    /* Adjust the ignition advance for engine temp */    
                    
                    tempComp1 = YTableLookup( engTemp, eTempEntries,
                        eTempAxis, engTempTbl ) ; 

                    firingTime1 = (varsize)
                       ( FIRE_TIME_NOM - ( ( advance1 * tempComp1 ) / 100 ) ) ; 

                    /* 
                     * Compute the dwell time compensation from battery 
                     * voltage 
                     *
                     */    
                    dwellComp1 = ZTableLookup( battery, engSpeed, battEntries,
                        speedEntries, batteryAxis, engSpeedAxis, dwellTbl ) ; 

                    dwell1 = (varsize)
                        ( ( DWELL_MIN * ( dwellComp1 + 100 ) ) / 100 ) ; 

                    /* No knock adjustment */
                    retard1 = 0 ;    

                } /* End of 'ignition/dwell adjustment' */
                else 
                {  
                    /* Else, did engine knock ? */
                    if( knocked && ( retard1 < KNOCK_MAX ) )
                    {        
                        /* Yes, so bump the ingnition retarder */
                        retard1 += KNOCK_STEP ;
                    }
                    else 
                    {        
                        if( retard1 > 0 )
                        {
                            /* Else, decrease the knock retarder to zero */
                            retard1 -= KNOCK_STEP ;    
                        }
                    }
                } /* End of 'knock detection' */

                /* Adjust firing time with knock retarder */
                firingTime1 = (varsize)( firingTime1 - retard1 ) ;
            } /* End of 'not just cranking' */
            else 
            {        
                /* Set base firing time */
                firingTime1 = FIRE_TIME_NOM ;    
                /* ...and set base dwell time */
                dwell1 = DWELL_MIN ;    
                /* ...and set base injector time */
                injectTime1 = INJECT_TIME_NOM ;    
                /* ...and set base injector duration */
                inject1 = INJECT_MIN ;    
            } /* End of 'just cranking' */

            /* Update engine parameter history */
            lastAirIntake1 = airIntake ;
            lastEngSpeed1 = engSpeed ; 
            lastThrottle1 = throttle ; 

        } /* End of 'engine running' */
        else 
        {            
            /* Else, engine is stalled! */
            /* So don't pump any fuel */
            fuelPump1 = false ;
            /* ...and don't fire the ignitors */
            enbIgnition1 = false ;
            /* Yes, so no more injection( duration )! */
            inject1 = 0 ;    
            /* ...and no enrichment for acceleration */
            accelComp1 = 0 ;    
            /* Set base firing time */
            firingTime1 = FIRE_TIME_NOM ;    
            /* ...and set base dwell time */
            dwell1 = DWELL_MIN ;    
            /* ...and set base injector time */
            injectTime1 = INJECT_TIME_NOM ;    

        } /* End of 'stalled engine' */

#if BMDEBUG        
        th_sprintf( szDebug, 
            "\n[%5ld, %5ld, %5ld, %5ld, %5ld, %5ld, "
            "%5ld, %2d, %2d, %2d]\n", 
            (n_long)dwell1, 
            (n_long)firingTime1, 
            (n_long)inject1, 
            (n_long)advance1, 
            (n_long)retard1, 
            (n_long)accelComp1, 
            (n_long)lambda1, 
            injectOn1, 
            fuelPump1, 
            enbIgnition1 ) ; 
        DebugOut( szDebug ) ; 
#else        /* Or write value directly to RAM file */
        WriteOut( firingTime1 ) ; 
        WriteOut( inject1 ) ; 
        WriteOut( advance1 ) ; 
        WriteOut( retard1 ) ; 
        WriteOut( accelComp1 ) ; 
        WriteOut( lambda1 ) ; 
        WriteOut( injectOn1 ) ; 
        WriteOut( fuelPump1 ) ; 
        WriteOut( enbIgnition1 ) ; 
#endif /* BMDEBUG */

        /***********************************************************************
            Second Pass                                                         
        ***********************************************************************/

        isTableLooped += GetInputValues() ;

#if BMDEBUG        
        th_sprintf( szDebug, " %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %2d, %2d", 
            (n_long)engSpeed, 
            (n_long)angleTime, 
            (n_long)airIntake, 
            (n_long)airTemp, 
            (n_long)engTemp, 
            (n_long)battery, 
            (n_long)throttle, 
            knocked, 
            cranking ) ; 
        DebugOut( szDebug ) ; 
#endif /* BMDEBUG */

        /* Engine running ? */
        if( engSpeed > 0 )
        {            
            /* Yes, enable fuel pump */
            fuelPump2 = true ;    
            /* ...and allow ignition firing */
            enbIgnition2 = true ;    

            /* Engine just cranking ? */
            if( !cranking )
            {            

                /* No, engine running, but has an engine parameter changed ? */
                if( ( airIntake != lastAirIntake2 ) || 
                    ( engSpeed != lastEngSpeed2 ) || 
                    ( throttle != lastThrottle2 ) )
                {        
                    /* Decelerating engine speed with same or less load ? */
                    /* ...or excessive RPM's ? */
                    if( ( ( engSpeed < lastEngSpeed2 ) &&
                          ( airIntake <= lastAirIntake2 ) ) ||
                          ( engSpeed > ENG_SPEED_MAX ) )
                    {            
                        /* Yes, so no more injection! */
                        inject2 = 0 ;    
                        /* ...and no enrichment for acceleration */
                        accelComp2 = 0 ;    
                    }
                    else 
                    {            
                        /* Else, normal injection */
                    
                        /* 
                         * Compute baseline injector duration from 
                         * load/speed map 
                         *
                         */    

                        lambda2 = ZTableLookup( airIntake, engSpeed, 
                            loadEntries, speedEntries, airIntakeAxis, 
                            engSpeedAxis, lambdaTbl ) ; 
                        
                        inject2 = lambda2 ; 

                        /* 
                         * Enrich based on engine-warmup, compensated by 
                         * warmup load/speed map 
                         *
                         */    

                        warmup2 = YTableLookup( engTemp, eTempEntries, 
                            eTempAxis, engWarmTbl ) ; 
                        
                        warmupComp2 = (varsize)( ( ZTableLookup( airIntake, 
                            engSpeed, loadEntries, speedEntries, 
                            airIntakeAxis, engSpeedAxis, warmupTbl ) * 
                            warmup2 ) / 100 ) ; 

                        inject2 = (varsize)
                            ( ( inject2 * warmupComp2 ) / 100 ) ; 

                        /* Adjust enrichment based on intake-air temperature */    
                        airTempComp2 = YTableLookup( airTemp, aTempEntries,
                            aTempAxis, airTempTbl ) ; 
 
                        inject2 = (varsize)
                            ( ( inject2 * airTempComp2 ) / 100 ) ; 

                        /* Adjust for change in throttle position( demand )*/    
                        if( ( throttle - lastThrottle2 ) > ACCEL_MIN )
                        {            
                            /* Only if accelerating */
                            accelComp2 = YTableLookup( engTemp, eTempEntries,
                                eTempAxis, accelTbl ) ; 
                            accelDelta2 = accelComp2 >> ACCEL_TIME ;                        
                        }
                        else 
                        {            
                            /* Else, maybe compensation is ongoing */
                            if( accelComp2 > 0 )   
                            {
                                /* So, decrease it with ECU time */
                                accelComp2 -= accelDelta2 ; 
                            }

                            if( accelComp2 < 0 )
                            {
                                /* ...until no more compensation */
                                accelComp2 = 0 ;    
                            }
                        }

                        /* ...and compensate for acceleration */        
                        inject2 = (varsize)
                            ( ( inject2 * ( 100 + accelComp2 ) ) / 100 ) ; 
                        
                        /* Adjust injector duration for battery voltage */    
                        voltComp2 = YTableLookup( battery, voltEntries,
                            voltAxis, voltTbl ) ; 

                        inject2 = ( varsize )( inject2 + voltComp2 ) ; 

                        /* Watch out for injector duration maximum limit */    
                        if( inject2 > INJECT_MAX ){
                            inject2 = INJECT_MAX ; 
                        }
                    } /* End of 'normal injection' */

                    /* 
                     * Determine the ignition advance, from engine speed and 
                     * air intake 
                     *
                     */    
                    advance2 = ZTableLookup( airIntake, engSpeed, loadEntries,
                        speedEntries, airIntakeAxis, engSpeedAxis,
                        advanceTbl ) ; 

                    /* Adjust the ignition advance for engine temp */    
                    
                    tempComp2 = YTableLookup( engTemp, eTempEntries,
                        eTempAxis, engTempTbl ) ; 

                    firingTime2 = (varsize)
                       ( FIRE_TIME_NOM - ( ( advance2 * tempComp2 ) / 100 ) ) ; 

                    /* 
                     * Compute the dwell time compensation from battery 
                     * voltage 
                     *
                     */    
                    dwellComp2 = ZTableLookup( battery, engSpeed, battEntries,
                        speedEntries, batteryAxis, engSpeedAxis, dwellTbl ) ; 

                    dwell2 = (varsize)
                        ( ( DWELL_MIN * ( dwellComp2 + 100 ) ) / 100 ) ; 

                    /* No knock adjustment */
                    retard2 = 0 ;    

                } /* End of 'ignition/dwell adjustment' */
                else 
                {  
                    /* Else, did engine knock ? */
                    if( knocked && ( retard2 < KNOCK_MAX ) )
                    {        
                        /* Yes, so bump the ingnition retarder */
                        retard2 += KNOCK_STEP ;
                    }
                    else 
                    {        
                        if( retard2 > 0 )
                        {
                            /* Else, decrease the knock retarder to zero */
                            retard2 -= KNOCK_STEP ;    
                        }
                    }
                } /* End of 'knock detection' */

                /* Adjust firing time with knock retarder */
                firingTime2 = (varsize)( firingTime2 - retard2 ) ;
            } /* End of 'not just cranking' */
            else 
            {        
                /* Set base firing time */
                firingTime2 = FIRE_TIME_NOM ;    
                /* ...and set base dwell time */
                dwell2 = DWELL_MIN ;    
                /* ...and set base injector time */
                injectTime2 = INJECT_TIME_NOM ;    
                /* ...and set base injector duration */
                inject2 = INJECT_MIN ;    
            } /* End of 'just cranking' */

            /* Update engine parameter history */
            lastAirIntake2 = airIntake ;
            lastEngSpeed2 = engSpeed ; 
            lastThrottle2 = throttle ; 

        } /* End of 'engine running' */
        else 
        {            
            /* Else, engine is stalled! */
            /* So don't pump any fuel */
            fuelPump2 = false ;
            /* ...and don't fire the ignitors */
            enbIgnition2 = false ;
            /* Yes, so no more injection( duration )! */
            inject2 = 0 ;    
            /* ...and no enrichment for acceleration */
            accelComp2 = 0 ;    
            /* Set base firing time */
            firingTime2 = FIRE_TIME_NOM ;    
            /* ...and set base dwell time */
            dwell2 = DWELL_MIN ;    
            /* ...and set base injector time */
            injectTime2 = INJECT_TIME_NOM ;    

        } /* End of 'stalled engine' */

#if BMDEBUG        
        th_sprintf( szDebug, 
            "\n[%5ld, %5ld, %5ld, %5ld, %5ld, %5ld, "
            "%5ld, %2d, %2d, %2d]\n", 
            (n_long)dwell2, 
            (n_long)firingTime2, 
            (n_long)inject2, 
            (n_long)advance2, 
            (n_long)retard2, 
            (n_long)accelComp2, 
            (n_long)lambda2, 
            injectOn2, 
            fuelPump2, 
            enbIgnition2 ) ; 
        DebugOut( szDebug ) ; 
#else        /* Or write value directly to RAM file */
        WriteOut( firingTime2 ) ; 
        WriteOut( inject2 ) ; 
        WriteOut( advance2 ) ; 
        WriteOut( retard2 ) ; 
        WriteOut( accelComp2 ) ; 
        WriteOut( lambda2 ) ; 
        WriteOut( injectOn2 ) ; 
        WriteOut( fuelPump2 ) ; 
        WriteOut( enbIgnition2 ) ; 
#endif /* BMDEBUG */

        /***********************************************************************
            Third Pass                                                          
        ***********************************************************************/

        isTableLooped += GetInputValues() ;

#if BMDEBUG        
        th_sprintf( szDebug, " %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %5ld, %2d, %2d", 
            (n_long)engSpeed, 
            (n_long)angleTime, 
            (n_long)airIntake, 
            (n_long)airTemp, 
            (n_long)engTemp, 
            (n_long)battery, 
            (n_long)throttle, 
            knocked, 
            cranking ) ; 
        DebugOut( szDebug ) ; 
#endif /* BMDEBUG */

        /* Engine running ? */
        if( engSpeed > 0 )
        {            
            /* Yes, enable fuel pump */
            fuelPump3 = true ;    
            /* ...and allow ignition firing */
            enbIgnition3 = true ;    

            /* Engine just cranking ? */
            if( !cranking )
            {            

                /* No, engine running, but has an engine parameter changed ? */
                if( ( airIntake != lastAirIntake3 ) || 
                    ( engSpeed != lastEngSpeed3 ) || 
                    ( throttle != lastThrottle3 ) )
                {        
                    /* Decelerating engine speed with same or less load ? */
                    /* ...or excessive RPM's ? */
                    if( ( ( engSpeed < lastEngSpeed3 ) &&
                          ( airIntake <= lastAirIntake3 ) ) ||
                          ( engSpeed > ENG_SPEED_MAX ) )
                    {            
                        /* Yes, so no more injection! */
                        inject3 = 0 ;    
                        /* ...and no enrichment for acceleration */
                        accelComp3 = 0 ;    
                    }
                    else 
                    {            
                        /* Else, normal injection */
                    
                        /* 
                         * Compute baseline injector duration from 
                         * load/speed map 
                         *
                         */    

                        lambda3 = ZTableLookup( airIntake, engSpeed, 
                            loadEntries, speedEntries, airIntakeAxis, 
                            engSpeedAxis, lambdaTbl ) ; 
                        
                        inject3 = lambda3 ; 

                        /* 
                         * Enrich based on engine-warmup, compensated by 
                         * warmup load/speed map 
                         *
                         */    

                        warmup3 = YTableLookup( engTemp, eTempEntries, 
                            eTempAxis, engWarmTbl ) ; 
                        
                        warmupComp3 = (varsize)( ( ZTableLookup( airIntake, 
                            engSpeed, loadEntries, speedEntries, 
                            airIntakeAxis, engSpeedAxis, warmupTbl ) * 
                            warmup3 ) / 100 ) ; 

                        inject3 = (varsize)
                            ( ( inject3 * warmupComp3 ) / 100 ) ; 

                        /* Adjust enrichment based on intake-air temperature */    
                        airTempComp3 = YTableLookup( airTemp, aTempEntries,
                            aTempAxis, airTempTbl ) ; 
 
                        inject3 = (varsize)
                            ( ( inject3 * airTempComp3 ) / 100 ) ; 

                        /* Adjust for change in throttle position( demand )*/    
                        if( ( throttle - lastThrottle3 ) > ACCEL_MIN )
                        {            
                            /* Only if accelerating */
                            accelComp3 = YTableLookup( engTemp, eTempEntries,
                                eTempAxis, accelTbl ) ; 
                            accelDelta3 = accelComp3 >> ACCEL_TIME ;                        
                        }
                        else 
                        {            
                            /* Else, maybe compensation is ongoing */
                            if( accelComp3 > 0 )   
                            {
                                /* So, decrease it with ECU time */
                                accelComp3 -= accelDelta3 ; 
                            }

                            if( accelComp3 < 0 )
                            {
                                /* ...until no more compensation */
                                accelComp3 = 0 ;    
                            }
                        }

                        /* ...and compensate for acceleration */        
                        inject3 = (varsize)
                            ( ( inject3 * ( 100 + accelComp3 ) ) / 100 ) ; 
                        
                        /* Adjust injector duration for battery voltage */    
                        voltComp3 = YTableLookup( battery, voltEntries,
                            voltAxis, voltTbl ) ; 

                        inject3 = ( varsize )( inject3 + voltComp3 ) ; 

                        /* Watch out for injector duration maximum limit */    
                        if( inject3 > INJECT_MAX ){
                            inject3 = INJECT_MAX ; 
                        }
                    } /* End of 'normal injection' */

                    /* 
                     * Determine the ignition advance, from engine speed and 
                     * air intake 
                     *
                     */    
                    advance3 = ZTableLookup( airIntake, engSpeed, loadEntries,
                        speedEntries, airIntakeAxis, engSpeedAxis,
                        advanceTbl ) ; 

                    /* Adjust the ignition advance for engine temp */    
                    
                    tempComp3 = YTableLookup( engTemp, eTempEntries,
                        eTempAxis, engTempTbl ) ; 

                    firingTime3 = (varsize)
                       ( FIRE_TIME_NOM - ( ( advance3 * tempComp3 ) / 100 ) ) ; 

                    /* 
                     * Compute the dwell time compensation from battery 
                     * voltage 
                     *
                     */    
                    dwellComp3 = ZTableLookup( battery, engSpeed, battEntries,
                        speedEntries, batteryAxis, engSpeedAxis, dwellTbl ) ; 

                    dwell3 = (varsize)
                        ( ( DWELL_MIN * ( dwellComp3 + 100 ) ) / 100 ) ; 

                    /* No knock adjustment */
                    retard3 = 0 ;    

                } /* End of 'ignition/dwell adjustment' */
                else 
                {  
                    /* Else, did engine knock ? */
                    if( knocked && ( retard3 < KNOCK_MAX ) )
                    {        
                        /* Yes, so bump the ingnition retarder */
                        retard3 += KNOCK_STEP ;
                    }
                    else 
                    {        
                        if( retard3 > 0 )
                        {
                            /* Else, decrease the knock retarder to zero */
                            retard3 -= KNOCK_STEP ;    
                        }
                    }
                } /* End of 'knock detection' */

                /* Adjust firing time with knock retarder */
                firingTime3 = (varsize)( firingTime3 - retard3 ) ;
            } /* End of 'not just cranking' */
            else 
            {        
                /* Set base firing time */
                firingTime3 = FIRE_TIME_NOM ;    
                /* ...and set base dwell time */
                dwell3 = DWELL_MIN ;    
                /* ...and set base injector time */
                injectTime3 = INJECT_TIME_NOM ;    
                /* ...and set base injector duration */
                inject3 = INJECT_MIN ;    
            } /* End of 'just cranking' */

            /* Update engine parameter history */
            lastAirIntake3 = airIntake ;
            lastEngSpeed3 = engSpeed ; 
            lastThrottle3 = throttle ; 

        } /* End of 'engine running' */
        else 
        {            
            /* Else, engine is stalled! */
            /* So don't pump any fuel */
            fuelPump3 = false ;
            /* ...and don't fire the ignitors */
            enbIgnition3 = false ;
            /* Yes, so no more injection( duration )! */
            inject3 = 0 ;    
            /* ...and no enrichment for acceleration */
            accelComp3 = 0 ;    
            /* Set base firing time */
            firingTime3 = FIRE_TIME_NOM ;    
            /* ...and set base dwell time */
            dwell3 = DWELL_MIN ;    
            /* ...and set base injector time */
            injectTime3 = INJECT_TIME_NOM ;    

        } /* End of 'stalled engine' */

#if BMDEBUG        
        th_sprintf( szDebug, 
            "\n[%5ld, %5ld, %5ld, %5ld, %5ld, %5ld, "
            "%5ld, %2d, %2d, %2d]\n", 
            (n_long)dwell3, 
            (n_long)firingTime3, 
            (n_long)inject3, 
            (n_long)advance3, 
            (n_long)retard3, 
            (n_long)accelComp3, 
            (n_long)lambda3, 
            injectOn3, 
            fuelPump3, 
            enbIgnition3 ) ; 
        DebugOut( szDebug ) ; 
#else        /* Or write value directly to RAM file */
        WriteOut( firingTime3 ) ; 
        WriteOut( inject3 ) ; 
        WriteOut( advance3 ) ; 
        WriteOut( retard3 ) ; 
        WriteOut( accelComp3 ) ; 
        WriteOut( lambda3 ) ; 
        WriteOut( injectOn3 ) ; 
        WriteOut( fuelPump3 ) ; 
        WriteOut( enbIgnition3 ) ; 

#if DATA_SIZE == 0
        i = (varsize)( loop_cnt & 0x0000FFFF ) ; 
        WriteOut( i ) ;
        i = (varsize)( loop_cnt >> 16 ) ; 
        WriteOut( i ) ; 
#else
        WriteOut( loop_cnt ) ; 
#endif
        i = 0xAAAA ; 
        WriteOut( i ) ;
#endif /* BMDEBUG */

#if BMDEBUG
        if( !th_harness_poll() )break ; 
#endif /* BMDEBUG */
    } 

    return 0;
} /* End of function 't_run_test' */


/*
*  Function :  GetTestData
*
*  Builds the tables of input data which represent 'engine speed', 
*  'crankshaft angle', 'engine load', 'air temp', 'engine temp', 
*  'battery voltage', 'throttle position', 'knock sensor', and 'cranking'
*  input parameters.  This is the "real world" data stream which drives
*  the algorithm.  This data is installed in RAM prior to execution of the
*  algorithm.  Eventually, this data will be downloaded from the host.
*
*/    

static n_int GetTestData( void )
{        
    n_int i ;
    n_int j ; 

    engSpeedValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ;
    angleTimeValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    airIntakeValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    airTempValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    engTempValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    batteryValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    throttleValue = 
        (varsize*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( varsize ) ) ; 
    knockedValue = 
        (n_int*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( n_int ) ) ; 
    crankingValue = 
        (n_int*)th_malloc( ( NUM_TESTS + 1 ) * sizeof( n_int ) ) ; 

    if( ( engSpeedValue == NULL ) ||
        ( angleTimeValue == NULL ) || 
        ( airIntakeValue == NULL ) || 
        ( airTempValue == NULL ) || 
        ( engTempValue == NULL ) || 
        ( batteryValue == NULL ) || 
        ( throttleValue == NULL ) || 
        ( knockedValue == NULL ) || 
        ( crankingValue == NULL ) )
	th_exit("Cannot Allocate Memory %s:%d", __FILE__,__LINE__ );

    /*  Copy the test values from ROM to RAM  */    
    for( i = 0, j = 0 ; i < NUM_TESTS ; i++, j++ )
    {        
        engSpeedValue[i] = inpValueROM[j++ ] ; 
        angleTimeValue[i] = inpValueROM[j++ ] ; 
        airIntakeValue[i] = inpValueROM[j++ ] ; 
        airTempValue[i] = inpValueROM[j++ ] ; 
        engTempValue[i] = inpValueROM[j++ ] ; 
        batteryValue[i] = inpValueROM[j++ ] ; 
        throttleValue[i] = inpValueROM[j++ ] ; 
        knockedValue[i] = inpValueROM[j++ ] ; 
        crankingValue[i] = inpValueROM[j] ;    
    }
    return true ; 
} /* End of function 'GetTestData' */

/*
*  Function :  GetInputValues
*
*    On each pass of the algorithm, a value for each of its input parms 
*    is returned.  Each time this function is called, the next input value is
*    pulled from the table in RAM.  The table wraps around, so that input is
*    continuous. A flag is returned TRUE whenever the table wraps around.
*
*/    

static n_int GetInputValues( n_void ) {        
    int array_index = input_index * 9;
    engSpeed = inpValueROM[array_index++] ; 
    angleTime = inpValueROM[array_index++] ; 
    airIntake = inpValueROM[array_index++] ; 
    airTemp = inpValueROM[array_index++] ; 
    engTemp = inpValueROM[array_index++] ; 
    battery = inpValueROM[array_index++] ; 
    throttle = inpValueROM[array_index++] ; 
    knocked = inpValueROM[array_index++] ; 
    cranking = inpValueROM[array_index++] ; 
    if (input_index >= NUM_TESTS) {
        input_index = 0;
    }
    return false;

    // engSpeed = engSpeedValue[tableCount] ; 
    // angleTime = angleTimeValue[tableCount] ; 
    // airIntake = airIntakeValue[tableCount] ; 
    // airTemp = airTempValue[tableCount] ; 
    // engTemp = engTempValue[tableCount] ; 
    // battery = batteryValue[tableCount] ; 
    // throttle = throttleValue[tableCount] ; 
    // knocked = knockedValue[tableCount] ; 
    // cranking = crankingValue[tableCount] ; 

    // /* Show that we're not at end of the test data */
    // if( ++tableCount < NUM_TESTS )   
    // {
    //     return false ; 
    // }

    // tableCount = 0 ;    /* ...or start over in the table */
    // return true ;       /* ...and remember the restart of the table */
} /* End of function 'GetInputValues' */

/*
*  Function :  GetZTables
*    Builds the following tables in RAM if asked for, 
*    otherwise just sets the pointers to the ROM code area.
*
*  engSpeedAxis   'y' axis of all 3D tables
*  airIntakeTbl   'x' axis of most 3D tables
*
*  lambdaTbl      'z' axis, air/fuel mix table as f( engSpeed, airIntake )
*  warmupTbl      'z' axis, warmup compensation, f( engSpeed, airIntake )
*  advanceTbl     'z' axis, ignition advance as f( engSpeed, airIntake )
*
*  batteryAxis    'x' axis of 3D dwell table
*  dwellTbl       'z' axis, dwell time compensation, f( engSpeed, battery )
*
*/    

static n_int GetZTables( n_void )
{        
    loadEntries = NUM_X_ENTRIES ;    /* Set number of entries in the table */
    speedEntries = NUM_Y_ENTRIES ; 
    battEntries = NUM_Y_ENTRIES ; 

    engSpeedAxis = engSpeedROM ; 
    airIntakeAxis = airIntakeROM ; 
    batteryAxis = batteryROM ; 
    lambdaTbl = lambdaROM ; 
    warmupTbl = warmupROM ; 
    advanceTbl = advanceROM ; 
    dwellTbl = dwellROM ; 

    return true ; 
} /* End of function 'GetZTables' */

/*
*  Function :  GetYTables
*    Builds the following tables in RAM if asked for, 
*    otherwise just sets the pointers to the ROM code area.
*
*  voltAxis       'x' axis for 'voltTbl'
*  voltTbl        'y' axis, injector compensation, f( battery )
*
*  eTempAxis      'x' axis for 'engWarmTbl' and 'engTempTbl'
*  engWarmTbl     'y' axis, injector compensation, f( engTemp )
*  accelTbl       'y' axis, injector compensation, f( engTemp )when accelerating
*  engTempTbl     'y' axis, ignition advance compensation, f( engTemp )
*
*  aTempAxis      'x' axis for 'airTempTbl'
*  airTempTbl     'y' axis, injector compensation, f( airTemp )
*
*/    

static n_int GetYTables( n_void )
{        
    voltEntries = NUM_X_ENTRIES ;    /* Set number of entries in the table */
    eTempEntries = NUM_X_ENTRIES ; 
    aTempEntries = NUM_X_ENTRIES ; 

    voltAxis = voltAxisROM ; 
    eTempAxis = eTempAxisROM ; 
    aTempAxis = aTempAxisROM ; 
    voltTbl = voltROM ; 
    engWarmTbl = engWarmROM ; 
    airTempTbl = airTempROM ; 
    engTempTbl = engTempROM ; 
    accelTbl = accelROM ; 

    return true ; 
} /* End of function 'GetZYables' */

/*
* FUNC    : ZTableLookup
*
* DESC    : 
*         
* RETURNS :
*
*/    

static varsize ZTableLookup( varsize xValue, 
              varsize yValue, 
              n_long xEntries, 
              n_long yEntries, 
              const varsize *xAxis, 
              const varsize *yAxis, 
              const varsize *zTable )
{        

    n_int i ;
    n_int j ; 
    n_long xDelta ;
    n_long yDelta ; 
    varsize outValue ; 

    /* First, find the 'x' axis grid coefficients */    
    for( i = 0 ; i < ( xEntries - 1 ) ; i++ )
    {        
        if( ( xValue < xAxis[i + 1] ) && ( xValue >= xAxis[i] ) )
        {
            break ;    
        }
    }

    if( i == ( xEntries - 1 ) )
    {
        xValue = xAxis[i] ; 
    }

    /*  
     * Use the 'x' coefficients to calculate the proportional delta
     * such that 'xDelta' is in the range 0..1000 
     *
     */    
    xDelta = (n_long)( ( xValue - xAxis[i] )* 1000 ) / 
                     ( xAxis[i + 1] - xAxis[i] ) ; 

    /* Next, find the 'y' axis grid coefficients */    
    for( j = 0 ; j < ( yEntries - 1 ) ; j++ )
    {        
        if( ( yValue < yAxis[j + 1] ) && ( yValue >= yAxis[j] ) )
        {
            break ;    
        }
    }

    if( j == ( yEntries - 1 ) )yValue = yAxis[j] ; 

    /*  
     * Use the 'y' coefficients to calculate the proportional grid delta
     * such that 'yDelta' is in the range 0..1000 
     *
     */    

    yDelta = (n_long)( ( yValue - yAxis[j] )* 1000 ) / 
                     ( yAxis[j + 1] - yAxis[j] ) ; 

    /*  
     * Now we can determine the interpolated output value for the input 
     * data from the table 'z' values 
     *
     */    

    outValue = (varsize)( ( ( ( 1000 - xDelta ) * ( 1000 - yDelta ) * 
        (n_long)zTable[i +( j * xEntries )] ) / 1000000 ) + 
        ( ( xDelta * ( 1000 - yDelta ) * 
        (n_long)zTable[( i + 1 )+( j *xEntries )] ) / 1000000 ) + 
        ( ( xDelta *yDelta *(n_long)zTable[( i + 1 ) + 
        ( xEntries *( j + 1 ) )] )/ 1000000 ) + 
        ( ( ( 1000 - xDelta ) * yDelta * 
        (n_long)zTable[i +( xEntries * ( j + 1 ) )] ) / 1000000 ) ) ; 

    return outValue ; 
} /* End of function 'ZTableLookup' */

/*
* FUNC    : ZTableLookup
*
* DESC    : 
*         
* RETURNS :
*
*/    

static varsize YTableLookup( varsize xValue,
               n_long xEntries, 
               const varsize *xAxis, 
               const varsize *yTable )
{        

    n_int i ; 
    n_long xDelta ; 
    varsize outValue ; 

    /*  First, find the 'x' axis range coefficients */    
    for( i = 0 ; i < ( xEntries - 1 ) ; i++ )
    {        
        if( ( xValue < xAxis[i + 1] ) && ( xValue >= xAxis[i] ) )
        {
            break ;    
        }
    }

    if( i == ( xEntries - 1 ) )
    {
        xValue = xAxis[i] ; 
    }

    /*
     * Use the 'x' coefficients to calculate the proportional delta
     * such that 'xDelta' is in the range 0..1000 
     *
     */    
    xDelta = (n_long)( ( xValue - xAxis[i] ) * 1000 ) / 
                     ( xAxis[i + 1] - xAxis[i] ) ; 

    /*  
     * Now we can determine the interpolated output value for the input data 
     * from the table 'y' values 
     *
     */    

    outValue = (varsize)( ( ( ( 1000 - xDelta ) * (n_long)yTable[i] ) / 1000 ) +
        ( ( xDelta * (n_long)yTable[i + 1] ) / 1000 ) ) ; 

    return outValue ; 

} /* End of function 'YTableLookup' */

